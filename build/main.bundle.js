(()=>{"use strict";var t,e,i,s,r,n,h={},o={};function a(t){var e=o[t];if(void 0!==e)return e.exports;var i=o[t]={id:t,loaded:!1,exports:{}};return h[t](i,i.exports,a),i.loaded=!0,i.exports}a.m=h,t="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",i="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",s=t=>{t&&!t.d&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},a.a=(r,n,h)=>{var o;h&&((o=[]).d=1),o&&(o.moduleId=r.id);var a,l,c,u=new Set,d=r.exports,m=new Promise(((t,e)=>{c=e,l=t}));m[e]=d,m[t]=t=>(o&&t(o),u.forEach(t),m.catch((t=>{}))),m.moduleId=r.id,r.exports=m,n((r=>{var n;a=(r=>r.map((r=>{if(null!==r&&"object"==typeof r){if(r[t])return r;if(r.then){var n=[];n.d=0,r.then((t=>{h[e]=t,s(n)}),(t=>{h[i]=t,s(n)}));var h={};return h[t]=t=>t(n),h}}var o={};return o[t]=t=>{},o[e]=r,o})))(r);var h=()=>a.map((t=>{if(t[i])throw t[i];return t[e]})),l=new Promise((e=>{(n=()=>e(h)).r=0;var i=t=>t!==o&&!u.has(t)&&(u.add(t),t&&!t.d&&(n.r++,t.push(n)));a.map((e=>e[t](i)))}));return n.r?l:h()}),(t=>(t?c(m[i]=t):l(d),s(o)))),o&&(o.d=0)},a.d=(t,e)=>{for(var i in e)a.o(e,i)&&!a.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},a.f={},a.e=t=>Promise.all(Object.keys(a.f).reduce(((e,i)=>(a.f[i](t,e),e)),[])),a.u=t=>t+".bundle.js",a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),a.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r={},n="equation-precise:",a.l=(t,e,i,s)=>{if(r[t])r[t].push(e);else{var h,o;if(void 0!==i)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var u=l[c];if(u.getAttribute("src")==t||u.getAttribute("data-webpack")==n+i){h=u;break}}h||(o=!0,(h=document.createElement("script")).charset="utf-8",h.timeout=120,a.nc&&h.setAttribute("nonce",a.nc),h.setAttribute("data-webpack",n+i),h.src=t),r[t]=[e];var d=(e,i)=>{h.onerror=h.onload=null,clearTimeout(m);var s=r[t];if(delete r[t],h.parentNode&&h.parentNode.removeChild(h),s&&s.forEach((t=>t(i))),e)return e(i)},m=setTimeout(d.bind(null,void 0,{type:"timeout",target:h}),12e4);h.onerror=d.bind(null,h.onerror),h.onload=d.bind(null,h.onload),o&&document.head.appendChild(h)}},a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.v=(t,e,i,s)=>{var r=fetch(a.p+""+i+".module.wasm");return"function"==typeof WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(r,s).then((e=>Object.assign(t,e.instance.exports))):r.then((t=>t.arrayBuffer())).then((t=>WebAssembly.instantiate(t,s))).then((e=>Object.assign(t,e.instance.exports)))},(()=>{var t;a.g.importScripts&&(t=a.g.location+"");var e=a.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");i.length&&(t=i[i.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=t})(),(()=>{var t={179:0};a.f.j=(e,i)=>{var s=a.o(t,e)?t[e]:void 0;if(0!==s)if(s)i.push(s[2]);else{var r=new Promise(((i,r)=>s=t[e]=[i,r]));i.push(s[2]=r);var n=a.p+a.u(e),h=new Error;a.l(n,(i=>{if(a.o(t,e)&&(0!==(s=t[e])&&(t[e]=void 0),s)){var r=i&&("load"===i.type?"missing":i.type),n=i&&i.target&&i.target.src;h.message="Loading chunk "+e+" failed.\n("+r+": "+n+")",h.name="ChunkLoadError",h.type=r,h.request=n,s[1](h)}}),"chunk-"+e,e)}};var e=(e,i)=>{var s,r,[n,h,o]=i,l=0;if(n.some((e=>0!==t[e]))){for(s in h)a.o(h,s)&&(a.m[s]=h[s]);o&&o(a)}for(e&&e(i);l<n.length;l++)r=n[l],a.o(t,r)&&t[r]&&t[r][0](),t[r]=0},i=self.webpackChunkequation_precise=self.webpackChunkequation_precise||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();class l{}class c extends l{static get instance(){return c._instance}}c._instance=new c;class u extends l{constructor(t){super(),this.Yt=t}get seconds(){return this.Yt}}class d extends l{constructor(t){super(),this.Et=t}get predicate(){return this.Et}}class m extends l{constructor(t){super(),this.Et=t}get predicate(){return this.Et}}class p{constructor(t){this.h=t,this.Wt=[],this.Ft=0}addCoroutine(t){this.Wt.push(t),this.Ft+=1}removeCoroutine(t){const e=this.Wt.indexOf(t);e>=0&&(this.Wt[e]=null,this.Ft-=1)}tryCompact(){if(p._needToCompactCount<=this.Wt.length-this.Ft){let t=0;for(let e=0;e<this.Wt.length;e++){const i=this.Wt[e];null!==i&&(this.Wt[t]=i,t+=1)}this.Wt.length=this.Ft}}updateAfterProcess(){const t=this.Wt;for(let e=0;e<t.length;e++){const i=t[e];null!=i&&(i.currentYieldInstructionExist?this.Pt(i):(t[e]=null,this.Ft-=1))}}Pt(t){const e=t.currentYieldInstruction;e instanceof u?(t.elapsedTime+=this.h.deltaTime,t.elapsedTime>=e.seconds&&(t.elapsedTime=0,t.fatchNextInstruction())):e instanceof d?e.predicate()&&t.fatchNextInstruction():e instanceof m?e.predicate()||t.fatchNextInstruction():null===e&&t.fatchNextInstruction()}endFrameAfterProcess(){const t=this.Wt;for(let e=0;e<t.length;e++){const i=t[e];null!=i&&(i.currentYieldInstructionExist?this.Ct(i):(t[e]=null,this.Ft-=1))}}Ct(t){t.currentYieldInstruction instanceof c&&t.fatchNextInstruction()}}p._needToCompactCount=16;class f{constructor(t){this.next=null,this.prev=null,this.value=t}}class y{constructor(){this.tt=!1,this.st=null,this.it=null,this.et=0}get length(){return this.et}add(t){const e=new f(t);null===this.st?(this.st=e,this.it=e):(this.it.next=e,e.prev=this.it,this.it=e),this.et++}lt(t){null!==t.prev?t.prev.next=t.next:this.st=t.next,null!==t.next?t.next.prev=t.prev:this.it=t.prev,this.et--}remove(t){let e=this.st;for(;null!==e;){if(e.value===t)return void this.lt(e);e=e.next}}removeAll(){this.st=null,this.it=null,this.et=0,this.tt=!0}forEach(t){this.tt=!1;let e=this.st;for(;null!==e;)if(t(e.value),this.tt){if(null===this.st)return;e=this.st,this.tt=!1}else e=e.next}}class g{constructor(){this.ht=new y}addListener(t){this.ht.add(t)}removeListener(t){this.ht.remove(t)}removeAllListeners(){this.ht.removeAll()}invoke(...t){this.ht.forEach((e=>{e(...t)}))}get length(){return this.ht.length}}class v{constructor(t){this.Ks=new g,this.ks=new g,this.Hs=new g,this.Is=new g,this.Xs=new g,this.Ys=new g,this.zs=new g,this.Gs=new g,this.Js=!1,this.Zs=null,this.$s=null,this.he=null,this.ue=t=>{this.le.set(t.key,!0),this.Ks.invoke(t)},this.we=t=>{this.le.set(t.key,!1),this.ks.invoke(t)},this.ve=t=>{this.Hs.invoke(t)},this.me=t=>{this.$s=t,this.Is.invoke(t)},this.de=t=>{this.$s=null,this.Xs.invoke(t)},this.fe=t=>{this.he=t,this.Ys.invoke(t)},this.pe=t=>{this.he=null,this.zs.invoke(t)},this.Ee=t=>{this.$s=t,this.Gs.invoke(t)},this.ge=t=>{this.Zs=()=>{this.ye("mouseenter",t.touches[0]),this.ye("mousedown",t.touches[0])}},this.Ce=t=>{this.Js&&(this.Js=!1,this.ye("mouseup",t.changedTouches[0]),this.ye("mouseleave",t.changedTouches[0]))},this.Ke=t=>{this.Zs&&(this.Zs(),this.Zs=null),this.ye("mousemove",t.touches[0]),this.Js=!0},this.be=t=>{this.Js&&(this.Js=!1,this.ye("mouseleave",t.changedTouches[0]))},this.le=new Map,this.F=!1,this.Pe=t}get map(){return this.le}dispose(){this.stopHandleEvents(),this.F=!0}startHandleEvents(){if(this.F)throw new Error("InputHandler is disposed.");window.addEventListener("keydown",this.ue),window.addEventListener("keyup",this.we),window.addEventListener("wheel",this.ve),this.Pe.addEventListener("mousedown",this.me),this.Pe.addEventListener("mouseup",this.de),this.Pe.addEventListener("mouseenter",this.fe),this.Pe.addEventListener("mouseleave",this.pe),this.Pe.addEventListener("mousemove",this.Ee),this.Pe.addEventListener("touchstart",this.ge),this.Pe.addEventListener("touchend",this.Ce),this.Pe.addEventListener("touchmove",this.Ke),this.Pe.addEventListener("touchcancel",this.be)}stopHandleEvents(){this.$s&&this.de(this.$s),this.he&&this.pe(this.he),this.le.clear(),window.removeEventListener("keydown",this.ue),window.removeEventListener("keyup",this.we),window.removeEventListener("wheel",this.ve),this.Pe.removeEventListener("mousedown",this.me),this.Pe.removeEventListener("mouseup",this.de),this.Pe.removeEventListener("mouseenter",this.fe),this.Pe.removeEventListener("mouseleave",this.pe),this.Pe.removeEventListener("mousemove",this.Ee),this.Pe.removeEventListener("touchstart",this.ge),this.Pe.removeEventListener("touchend",this.Ce),this.Pe.removeEventListener("touchmove",this.Ke),this.Pe.removeEventListener("touchcancel",this.be)}ye(t,e){const i=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,detail:1,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:null});e.target.dispatchEvent(i)}get onKeyDown(){return this.Ks}get onKeyUp(){return this.ks}get onWheel(){return this.Hs}get onPointerDown(){return this.Is}get onPointerUp(){return this.Xs}get onPointerEnter(){return this.Ys}get onPointerLeave(){return this.zs}get onPointerMove(){return this.Gs}}var x=function(){function t(t,e){this.color=!0,this.key=void 0,this.value=void 0,this.parent=void 0,this.brother=void 0,this.leftChild=void 0,this.rightChild=void 0,void 0!==t&&void 0!==e&&(this.key=t,this.value=e)}return t.prototype.rotateLeft=function(){var t=this.parent,e=this.brother,i=this.leftChild,s=this.rightChild;if(!s)throw new Error("unknown error");var r=s.leftChild,n=s.rightChild;return t&&void 0!==t.key&&(t.leftChild===this?t.leftChild=s:t.rightChild===this&&(t.rightChild=s)),s.parent=t,s.brother=e,s.leftChild=this,s.rightChild=n,e&&(e.brother=s),this.parent=s,this.brother=n,this.leftChild=i,this.rightChild=r,n&&(n.parent=s,n.brother=this),i&&(i.parent=this,i.brother=r),r&&(r.parent=this,r.brother=i),s},t.prototype.rotateRight=function(){var t=this.parent,e=this.brother,i=this.leftChild;if(!i)throw new Error("unknown error");var s=this.rightChild,r=i.leftChild,n=i.rightChild;return t&&void 0!==t.key&&(t.leftChild===this?t.leftChild=i:t.rightChild===this&&(t.rightChild=i)),i.parent=t,i.brother=e,i.leftChild=r,i.rightChild=this,e&&(e.brother=i),r&&(r.parent=i,r.brother=this),this.parent=i,this.brother=r,this.leftChild=n,this.rightChild=s,n&&(n.parent=this,n.brother=s),s&&(s.parent=this,s.brother=n),i},t.prototype.remove=function(){if(this.leftChild||this.rightChild)throw new Error("can only remove leaf node");this.parent&&(this===this.parent.leftChild?this.parent.leftChild=void 0:this===this.parent.rightChild&&(this.parent.rightChild=void 0)),this.brother&&(this.brother.brother=void 0),this.key=void 0,this.value=void 0,this.parent=void 0,this.brother=void 0},t.TreeNodeColorType={red:!0,black:!1},t}(),_=function(t,e,i){void 0===i&&(i="normal"),Object.defineProperties(this,{iteratorType:{value:i},node:{value:t},pointer:{get:function(){if(void 0===t.key)throw new Error("Tree iterator access denied!");if(void 0===t.value)return t.key;var e={};return Object.defineProperties(e,{key:{get:function(){return t.key},enumerable:!0},value:{get:function(){return t.value},set:function(e){t.value=e},enumerable:!0}}),e},enumerable:!0}}),this.equals=function(e){if(e.constructor.name!==this.constructor.name)throw new Error("obj's constructor is not ".concat(this.constructor.name,"!"));if(this.iteratorType!==e.iteratorType)throw new Error("iterator type error!");return t===e.node};var s=function(){var e,i=t;if(i.color===x.TreeNodeColorType.red&&(null===(e=i.parent)||void 0===e?void 0:e.parent)===i)i=i.rightChild;else if(i.leftChild)for(i=i.leftChild;i.rightChild;)i=null==i?void 0:i.rightChild;else{for(var s=(null==i?void 0:i.parent)||void 0;(null==s?void 0:s.leftChild)===i;)s=(null==(i=s)?void 0:i.parent)||void 0;i=s}if(void 0===i)throw new Error("unknown error");return i},r=function(){var e=t;if(null==e?void 0:e.rightChild)for(e=e.rightChild;e.leftChild;)e=null==e?void 0:e.leftChild;else{for(var i=(null==e?void 0:e.parent)||void 0;(null==i?void 0:i.rightChild)===e;)i=(null==(e=i)?void 0:e.parent)||void 0;e.rightChild!==i&&(e=i)}if(void 0===e)throw new Error("unknown error");return e};this.pre=function(){if("reverse"===this.iteratorType){if(t===e.rightChild)throw new Error("Tree iterator access denied!");var i=r();return new _(i,e,this.iteratorType)}if(t===e.leftChild)throw new Error("Tree iterator access denied!");var n=s();return new _(n,e)},this.next=function(){if("reverse"===this.iteratorType){if(t===e)throw new Error("Tree iterator access denied!");var i=s();return new _(i,e,this.iteratorType)}if(t===e)throw new Error("Tree iterator access denied!");var n=r();return new _(n,e)}},w=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],s=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};const C=function(t,e){var i=this;void 0===t&&(t=[]),e=e||function(t,e){return t<e?-1:t>e?1:0};var s=0,r=new x;r.color=x.TreeNodeColorType.black;var n=new x;n.parent=r,r.parent=n,this.size=function(){return s},this.empty=function(){return 0===s},this.clear=function(){s=0,r.key=void 0,r.leftChild=r.rightChild=r.brother=void 0,n.leftChild=n.rightChild=void 0},this.begin=function(){return new _(n.leftChild||n,n)},this.end=function(){return new _(n,n)},this.rBegin=function(){return new _(n.rightChild||n,n)},this.rEnd=function(){return new _(n,n)};var h=function(t){if(!t||void 0===t.key)throw new Error("unknown error");return t.leftChild?h(t.leftChild):t},o=function(t){if(!t||void 0===t.key)throw new Error("unknown error");return t.rightChild?o(t.rightChild):t};this.front=function(){var t;return null===(t=n.leftChild)||void 0===t?void 0:t.key},this.back=function(){var t;return null===(t=n.rightChild)||void 0===t?void 0:t.key},this.forEach=function(t){var e,i,s=0;try{for(var r=w(this),n=r.next();!n.done;n=r.next())t(n.value,s++)}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}},this.getElementByPos=function(t){var e,i;if(t<0||t>=this.size())throw new Error("pos must more than 0 and less than set's size");var s=0;try{for(var r=w(this),n=r.next();!n.done;n=r.next()){var h=n.value;if(s===t)return h;++s}}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}throw new Error("unknown error")};var a=function(t){var e=t.parent;if(!e||e===n){if(t===r)return;throw new Error("unknown error")}if(t.color!==x.TreeNodeColorType.red){var i=t.brother;if(!i)throw new Error("unknown error");if(t===e.leftChild)if(i.color===x.TreeNodeColorType.red){i.color=x.TreeNodeColorType.black,e.color=x.TreeNodeColorType.red;var s=e.rotateLeft();r===e&&(r=s,n.parent=r,r.parent=n),a(t)}else i.color===x.TreeNodeColorType.black&&(i.rightChild&&i.rightChild.color===x.TreeNodeColorType.red?(i.color=e.color,e.color=x.TreeNodeColorType.black,i.rightChild&&(i.rightChild.color=x.TreeNodeColorType.black),s=e.rotateLeft(),r===e&&(r=s,n.parent=r,r.parent=n),t.color=x.TreeNodeColorType.black):i.rightChild&&i.rightChild.color!==x.TreeNodeColorType.black||!i.leftChild||i.leftChild.color!==x.TreeNodeColorType.red?i.leftChild&&i.leftChild.color!==x.TreeNodeColorType.black||i.rightChild&&i.rightChild.color!==x.TreeNodeColorType.black||(i.color=x.TreeNodeColorType.red,a(e)):(i.color=x.TreeNodeColorType.red,i.leftChild&&(i.leftChild.color=x.TreeNodeColorType.black),s=i.rotateRight(),r===i&&(r=s,n.parent=r,r.parent=n),a(t)));else t===e.rightChild&&(i.color===x.TreeNodeColorType.red?(i.color=x.TreeNodeColorType.black,e.color=x.TreeNodeColorType.red,s=e.rotateRight(),r===e&&(r=s,n.parent=r,r.parent=n),a(t)):i.color===x.TreeNodeColorType.black&&(i.leftChild&&i.leftChild.color===x.TreeNodeColorType.red?(i.color=e.color,e.color=x.TreeNodeColorType.black,i.leftChild&&(i.leftChild.color=x.TreeNodeColorType.black),s=e.rotateRight(),r===e&&(r=s,n.parent=r,r.parent=n),t.color=x.TreeNodeColorType.black):i.leftChild&&i.leftChild.color!==x.TreeNodeColorType.black||!i.rightChild||i.rightChild.color!==x.TreeNodeColorType.red?i.leftChild&&i.leftChild.color!==x.TreeNodeColorType.black||i.rightChild&&i.rightChild.color!==x.TreeNodeColorType.black||(i.color=x.TreeNodeColorType.red,a(e)):(i.color=x.TreeNodeColorType.red,i.rightChild&&(i.rightChild.color=x.TreeNodeColorType.black),s=i.rotateLeft(),r===i&&(r=s,n.parent=r,r.parent=n),a(t))))}else t.color=x.TreeNodeColorType.black},l=function(t){for(var i,l,c,u,d,m,p=t;p.leftChild||p.rightChild;){if(p.rightChild){p=h(p.rightChild);var f=t.key;t.key=p.key,p.key=f,t=p}p.leftChild&&(p=o(p.leftChild),f=t.key,t.key=p.key,p.key=f,t=p)}if(void 0===p.key)throw new Error("unknown error");n.leftChild&&void 0!==n.leftChild.key&&0===e(n.leftChild.key,p.key)&&(n.leftChild!==r?n.leftChild=null===(i=n.leftChild)||void 0===i?void 0:i.parent:(null===(l=n.leftChild)||void 0===l?void 0:l.rightChild)?n.leftChild=null===(c=n.leftChild)||void 0===c?void 0:c.rightChild:n.leftChild=void 0),n.rightChild&&void 0!==n.rightChild.key&&0===e(n.rightChild.key,p.key)&&(n.rightChild!==r?n.rightChild=null===(u=n.rightChild)||void 0===u?void 0:u.parent:(null===(d=n.rightChild)||void 0===d?void 0:d.leftChild)?n.rightChild=null===(m=n.rightChild)||void 0===m?void 0:m.leftChild:n.rightChild=void 0),a(p),p&&p.remove(),--s,r.color=x.TreeNodeColorType.black},c=function(t,e){return!(!t||void 0===t.key)&&(!!c(t.leftChild,e)||!!e(t)||c(t.rightChild,e))};this.eraseElementByPos=function(t){if(t<0||t>=s)throw new Error("pos must more than 0 and less than set's size");var e=0;c(r,(function(i){return t===e?(l(i),!0):(++e,!1)}))},this.eraseElementByValue=function(t){if(!this.empty()){var i=m(r,t);void 0!==i&&void 0!==i.key&&0===e(i.key,t)&&l(i)}};var u=function(t,i){if(!t||void 0===t.key)throw new Error("unknown error");var s=e(i,t.key);return s<0?t.leftChild?u(t.leftChild,i):(t.leftChild=new x,t.leftChild.parent=t,t.leftChild.brother=t.rightChild,t.rightChild&&(t.rightChild.brother=t.leftChild),t.leftChild):s>0?t.rightChild?u(t.rightChild,i):(t.rightChild=new x,t.rightChild.parent=t,t.rightChild.brother=t.leftChild,t.leftChild&&(t.leftChild.brother=t.rightChild),t.rightChild):t},d=function(t){var e=t.parent;if(!e||e===n){if(t===r)return;throw new Error("unknown error")}if(e.color!==x.TreeNodeColorType.black&&e.color===x.TreeNodeColorType.red){var i=e.brother,s=e.parent;if(!s)throw new Error("unknown error");if(i&&i.color===x.TreeNodeColorType.red)i.color=e.color=x.TreeNodeColorType.black,s.color=x.TreeNodeColorType.red,d(s);else if(!i||i.color===x.TreeNodeColorType.black)if(e===s.leftChild)if(t===e.leftChild){e.color=x.TreeNodeColorType.black,s.color=x.TreeNodeColorType.red;var h=s.rotateRight();s===r&&(r=h,n.parent=r,r.parent=n)}else t===e.rightChild&&(h=e.rotateLeft(),e===r&&(r=h,n.parent=r,r.parent=n),d(e));else e===s.rightChild&&(t===e.leftChild?(h=e.rotateRight(),e===r&&(r=h,n.parent=r,r.parent=n),d(e)):t===e.rightChild&&(e.color=x.TreeNodeColorType.black,s.color=x.TreeNodeColorType.red,h=s.rotateLeft(),s===r&&(r=h,n.parent=r,r.parent=n)))}};this.insert=function(t){if(null==t)throw new Error("to avoid some unnecessary errors, we don't suggest you insert null or undefined here");if(this.empty())return++s,r.key=t,r.color=x.TreeNodeColorType.black,n.leftChild=r,void(n.rightChild=r);var i=u(r,t);void 0!==i.key&&0===e(i.key,t)||(++s,i.key=t,(void 0===n.leftChild||void 0===n.leftChild.key||e(n.leftChild.key,t)>0)&&(n.leftChild=i),(void 0===n.rightChild||void 0===n.rightChild.key||e(n.rightChild.key,t)<0)&&(n.rightChild=i),d(i),r.color=x.TreeNodeColorType.black)};var m=function(t,i){if(t&&void 0!==t.key){var s=e(i,t.key);return s<0?m(t.leftChild,i):s>0?m(t.rightChild,i):t}};this.find=function(t){var e=m(r,t);return void 0!==e&&void 0!==e.key?new _(e,n):this.end()};var p=function(t,i){if(t&&void 0!==t.key){var s=e(t.key,i);if(0===s)return t;if(s<0)return p(t.rightChild,i);var r=p(t.leftChild,i);return void 0===r?t:r}};this.lowerBound=function(t){var e=p(r,t);return void 0===e?this.end():new _(e,n)};var f=function(t,i){if(t&&void 0!==t.key){if(e(t.key,i)<=0)return f(t.rightChild,i);var s=f(t.leftChild,i);return void 0===s?t:s}};this.upperBound=function(t){var e=f(r,t);return void 0===e?this.end():new _(e,n)};var y=function(t,i){if(t&&void 0!==t.key){var s=e(t.key,i);if(0===s)return t;if(s>0)return y(t.leftChild,i);var r=y(t.rightChild,i);return void 0===r?t:r}};this.reverseLowerBound=function(t){var e=y(r,t);return void 0===e?this.end():new _(e,n)};var g=function(t,i){if(t&&void 0!==t.key){if(e(t.key,i)>=0)return g(t.leftChild,i);var s=g(t.rightChild,i);return void 0===s?t:s}};if(this.reverseUpperBound=function(t){var e=g(r,t);return void 0===e?this.end():new _(e,n)},this.union=function(t){var e=this;t.forEach((function(t){return e.insert(t)}))},this.getHeight=function(){if(this.empty())return 0;var t=function(e){return e?Math.max(t(e.leftChild),t(e.rightChild))+1:1};return t(r)},"symbol"==typeof Symbol.iterator){var v=function(t){return function(t,e){var i,s,r,n,h={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function o(n){return function(o){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;h;)try{if(i=1,s&&(r=2&n[0]?s.return:n[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,n[1])).done)return r;switch(s=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return h.label++,{value:n[1],done:!1};case 5:h.label++,s=n[1],n=[0];continue;case 7:n=h.ops.pop(),h.trys.pop();continue;default:if(!((r=(r=h.trys).length>0&&r[r.length-1])||6!==n[0]&&2!==n[0])){h=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){h.label=n[1];break}if(6===n[0]&&h.label<r[1]){h.label=r[1],r=n;break}if(r&&h.label<r[2]){h.label=r[2],h.ops.push(n);break}r[2]&&h.ops.pop(),h.trys.pop();continue}n=e.call(t,h)}catch(t){n=[6,t],s=0}finally{i=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,o])}}}(this,(function(e){switch(e.label){case 0:return t&&void 0!==t.key?[5,w(v(t.leftChild))]:[2];case 1:return e.sent(),[4,t.key];case 2:return e.sent(),[5,w(v(t.rightChild))];case 3:return e.sent(),[2]}}))};this[Symbol.iterator]=function(){return v(r)}}t.forEach((function(t){return i.insert(t)}))};class b{constructor(t){this.nt=null,this.rt=new C(void 0,t),this.ut=new C(void 0,t),this.ft=new C(void 0,t),this.dt=new C(void 0,t)}get size(){return this.rt.size()}insert(t){t.isRemoved=!1,null!==this.nt?this.ut.insert(t):this.rt.insert(t)}delete(t){null!==this.nt?(t.isRemoved=!0,this.dt.insert(t)):this.rt.eraseElementByValue(t)}clear(){this.rt.clear(),this.ut.clear(),this.dt.clear()}forEach(t){this.nt=this.rt,this.nt.forEach((e=>{e.isRemoved||t(e)}));do{this.nt=this.ot(),this.nt.forEach((e=>{e.isRemoved||t(e)}))}while(0<this.ut.size()||0<this.dt.size());this.nt=null}ot(){this.nt=null,this.dt.forEach((t=>this.delete(t))),this.ut.forEach((t=>this.insert(t)));const t=this.ut;return this.ut=this.ft,this.ft=t,this.ut.clear(),this.dt.clear(),t}}class M{constructor(t,e,i,s){this.isRemoved=!1,this.Dt=i,this.St=t.generateEventId(),this.kt=s,this.At=e}static createAwakeEvent(t,e){return new M(t,e,0,0)}static createStartEvent(t,e,i){return new M(t,e,2,i)}static createUpdateEvent(t,e,i){return new M(t,e,3,i)}static createOnEnableEvent(t,e,i){return new M(t,e,1,i)}static createOnDisableEvent(t,e,i){return new M(t,e,1,i)}static createOnDestroyEvent(t,e,i){return new M(t,e,4,i)}static createOnCollisionEnter2DEvent(t,e,i){return new M(t,e,1,i)}static createOnCollisionStay2DEvent(t,e,i){return new M(t,e,1,i)}static createOnCollisionExit2DEvent(t,e,i){return new M(t,e,1,i)}static createOnTriggerEnter2DEvent(t,e,i){return new M(t,e,1,i)}static createOnTriggerStay2DEvent(t,e,i){return new M(t,e,1,i)}static createOnTriggerExit2DEvent(t,e,i){return new M(t,e,1,i)}get invoke(){return this.At}static comparator(t,e){return t.Dt===e.Dt?t.kt===e.kt?t.St-e.St:t.kt-e.kt:t.Dt-e.Dt}}function E(t){return void 0!==t.onWorldMatrixUpdated}class S{constructor(){this.ti=new Set,this.ii=new b(M.comparator),this.ei=new b(M.comparator),this.ni=new b(M.comparator),this.oi=new b(M.comparator),this.ri=new b(M.comparator),this.si=new b(M.comparator)}registerComponent(t){E(t)&&this.ti.add(t);const e=t._engine_internal_componentEventContainer;e.onCollisionEnter2D&&this.ii.insert(e.onCollisionEnter2D),e.onCollisionStay2D&&this.ei.insert(e.onCollisionStay2D),e.onCollisionExit2D&&this.ni.insert(e.onCollisionExit2D),e.onTriggerEnter2D&&this.oi.insert(e.onTriggerEnter2D),e.onTriggerStay2D&&this.ri.insert(e.onTriggerStay2D),e.onTriggerExit2D&&this.si.insert(e.onTriggerExit2D)}unregisterComponent(t){E(t)&&this.ti.delete(t);const e=t._engine_internal_componentEventContainer;e.onCollisionEnter2D&&this.ii.delete(e.onCollisionEnter2D),e.onCollisionStay2D&&this.ei.delete(e.onCollisionStay2D),e.onCollisionExit2D&&this.ni.delete(e.onCollisionExit2D),e.onTriggerEnter2D&&this.oi.delete(e.onTriggerEnter2D),e.onTriggerStay2D&&this.ri.delete(e.onTriggerStay2D),e.onTriggerExit2D&&this.si.delete(e.onTriggerExit2D)}invokeOnWorldMatrixUpdated(){for(const t of this.ti)t.onWorldMatrixUpdated()}invokeOnCollisionEnter2D(t){0!==this.ii.size&&this.ii.forEach((e=>e.invoke(t)))}invokeOnCollisionStay2D(t){0!==this.ei.size&&this.ei.forEach((e=>e.invoke(t)))}invokeOnCollisionExit2D(t){0!==this.ni.size&&this.ni.forEach((e=>e.invoke(t)))}invokeOnTriggerEnter2D(t){0!==this.oi.size&&this.oi.forEach((e=>e.invoke(t)))}invokeOnTriggerStay2D(t){0!==this.ri.size&&this.ri.forEach((e=>e.invoke(t)))}invokeOnTriggerExit2D(t){0!==this.si.size&&this.si.forEach((e=>e.invoke(t)))}}const O=[];for(let t=0;t<256;t++)O[t]=(t<16?"0":"")+t.toString(16);const z=Math.PI/180,k=180/Math.PI;function T(t,e,i){return Math.max(e,Math.min(i,t))}class D{constructor(t=0,e=0,i=0,s=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=s}static slerp(t,e,i,s){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(t,e,s)}static slerpFlat(t,e,i,s,r,n,h){let o=i[s+0],a=i[s+1],l=i[s+2],c=i[s+3];const u=r[n+0],d=r[n+1],m=r[n+2],p=r[n+3];if(0===h)return t[e+0]=o,t[e+1]=a,t[e+2]=l,void(t[e+3]=c);if(1===h)return t[e+0]=u,t[e+1]=d,t[e+2]=m,void(t[e+3]=p);if(c!==p||o!==u||a!==d||l!==m){let t=1-h;const e=o*u+a*d+l*m+c*p,i=e>=0?1:-1,s=1-e*e;if(s>Number.EPSILON){const r=Math.sqrt(s),n=Math.atan2(r,e*i);t=Math.sin(t*n)/r,h=Math.sin(h*n)/r}const r=h*i;if(o=o*t+u*r,a=a*t+d*r,l=l*t+m*r,c=c*t+p*r,t===1-h){const t=1/Math.sqrt(o*o+a*a+l*l+c*c);o*=t,a*=t,l*=t,c*=t}}t[e]=o,t[e+1]=a,t[e+2]=l,t[e+3]=c}static multiplyQuaternionsFlat(t,e,i,s,r,n){const h=i[s],o=i[s+1],a=i[s+2],l=i[s+3],c=r[n],u=r[n+1],d=r[n+2],m=r[n+3];return t[e]=h*m+l*c+o*d-a*u,t[e+1]=o*m+l*u+a*c-h*d,t[e+2]=a*m+l*d+h*u-o*c,t[e+3]=l*m-h*c-o*u-a*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,s){return this._x=t,this._y=e,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,s=t._y,r=t._z,n=t._order,h=Math.cos,o=Math.sin,a=h(i/2),l=h(s/2),c=h(r/2),u=o(i/2),d=o(s/2),m=o(r/2);switch(n){case"XYZ":this._x=u*l*c+a*d*m,this._y=a*d*c-u*l*m,this._z=a*l*m+u*d*c,this._w=a*l*c-u*d*m;break;case"YXZ":this._x=u*l*c+a*d*m,this._y=a*d*c-u*l*m,this._z=a*l*m-u*d*c,this._w=a*l*c+u*d*m;break;case"ZXY":this._x=u*l*c-a*d*m,this._y=a*d*c+u*l*m,this._z=a*l*m+u*d*c,this._w=a*l*c-u*d*m;break;case"ZYX":this._x=u*l*c-a*d*m,this._y=a*d*c+u*l*m,this._z=a*l*m-u*d*c,this._w=a*l*c+u*d*m;break;case"YZX":this._x=u*l*c+a*d*m,this._y=a*d*c+u*l*m,this._z=a*l*m-u*d*c,this._w=a*l*c-u*d*m;break;case"XZY":this._x=u*l*c-a*d*m,this._y=a*d*c-u*l*m,this._z=a*l*m+u*d*c,this._w=a*l*c+u*d*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+n)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,s=Math.sin(i);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],s=e[4],r=e[8],n=e[1],h=e[5],o=e[9],a=e[2],l=e[6],c=e[10],u=i+h+c;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(l-o)*t,this._y=(r-a)*t,this._z=(n-s)*t}else if(i>h&&i>c){const t=2*Math.sqrt(1+i-h-c);this._w=(l-o)/t,this._x=.25*t,this._y=(s+n)/t,this._z=(r+a)/t}else if(h>c){const t=2*Math.sqrt(1+h-i-c);this._w=(r-a)/t,this._x=(s+n)/t,this._y=.25*t,this._z=(o+l)/t}else{const t=2*Math.sqrt(1+c-i-h);this._w=(n-s)/t,this._x=(r+a)/t,this._y=(o+l)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(T(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const s=Math.min(1,e/i);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,s=t._y,r=t._z,n=t._w,h=e._x,o=e._y,a=e._z,l=e._w;return this._x=i*l+n*h+s*a-r*o,this._y=s*l+n*o+r*h-i*a,this._z=r*l+n*a+i*o-s*h,this._w=n*l-i*h-s*o-r*a,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,s=this._y,r=this._z,n=this._w;let h=n*t._w+i*t._x+s*t._y+r*t._z;if(h<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,h=-h):this.copy(t),h>=1)return this._w=n,this._x=i,this._y=s,this._z=r,this;const o=1-h*h;if(o<=Number.EPSILON){const t=1-e;return this._w=t*n+e*this._w,this._x=t*i+e*this._x,this._y=t*s+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const a=Math.sqrt(o),l=Math.atan2(a,h),c=Math.sin((1-e)*l)/a,u=Math.sin(e*l)/a;return this._w=n*c+this._w*u,this._x=i*c+this._x*u,this._y=s*c+this._y*u,this._z=r*c+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),s=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(s),i*Math.sin(r),i*Math.cos(r),e*Math.sin(s))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class j{constructor(t=0,e=0,i=0){this.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(P.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(P.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,s=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*s,this.y=r[1]*e+r[4]*i+r[7]*s,this.z=r[2]*e+r[5]*i+r[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,s=this.z,r=t.elements,n=1/(r[3]*e+r[7]*i+r[11]*s+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*s+r[12])*n,this.y=(r[1]*e+r[5]*i+r[9]*s+r[13])*n,this.z=(r[2]*e+r[6]*i+r[10]*s+r[14])*n,this}applyQuaternion(t){const e=this.x,i=this.y,s=this.z,r=t.x,n=t.y,h=t.z,o=t.w,a=o*e+n*s-h*i,l=o*i+h*e-r*s,c=o*s+r*i-n*e,u=-r*e-n*i-h*s;return this.x=a*o+u*-r+l*-h-c*-n,this.y=l*o+u*-n+c*-r-a*-h,this.z=c*o+u*-h+a*-n-l*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,s=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*s,this.y=r[1]*e+r[5]*i+r[9]*s,this.z=r[2]*e+r[6]*i+r[10]*s,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,s=t.y,r=t.z,n=e.x,h=e.y,o=e.z;return this.x=s*o-r*h,this.y=r*n-i*o,this.z=i*h-s*n,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return R.copy(this).projectOnVector(t),this.sub(R)}reflect(t){return this.sub(R.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(T(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,s=this.z-t.z;return e*e+i*i+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const s=Math.sin(e)*t;return this.x=s*Math.sin(i),this.y=Math.cos(e)*t,this.z=s*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const R=new j,P=new D;class F{constructor(){this.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,s,r,n,h,o,a,l,c,u,d,m,p,f){const y=this.elements;return y[0]=t,y[4]=e,y[8]=i,y[12]=s,y[1]=r,y[5]=n,y[9]=h,y[13]=o,y[2]=a,y[6]=l,y[10]=c,y[14]=u,y[3]=d,y[7]=m,y[11]=p,y[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new F).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,s=1/A.setFromMatrixColumn(t,0).length(),r=1/A.setFromMatrixColumn(t,1).length(),n=1/A.setFromMatrixColumn(t,2).length();return e[0]=i[0]*s,e[1]=i[1]*s,e[2]=i[2]*s,e[3]=0,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=0,e[8]=i[8]*n,e[9]=i[9]*n,e[10]=i[10]*n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,i=t.x,s=t.y,r=t.z,n=Math.cos(i),h=Math.sin(i),o=Math.cos(s),a=Math.sin(s),l=Math.cos(r),c=Math.sin(r);if("XYZ"===t.order){const t=n*l,i=n*c,s=h*l,r=h*c;e[0]=o*l,e[4]=-o*c,e[8]=a,e[1]=i+s*a,e[5]=t-r*a,e[9]=-h*o,e[2]=r-t*a,e[6]=s+i*a,e[10]=n*o}else if("YXZ"===t.order){const t=o*l,i=o*c,s=a*l,r=a*c;e[0]=t+r*h,e[4]=s*h-i,e[8]=n*a,e[1]=n*c,e[5]=n*l,e[9]=-h,e[2]=i*h-s,e[6]=r+t*h,e[10]=n*o}else if("ZXY"===t.order){const t=o*l,i=o*c,s=a*l,r=a*c;e[0]=t-r*h,e[4]=-n*c,e[8]=s+i*h,e[1]=i+s*h,e[5]=n*l,e[9]=r-t*h,e[2]=-n*a,e[6]=h,e[10]=n*o}else if("ZYX"===t.order){const t=n*l,i=n*c,s=h*l,r=h*c;e[0]=o*l,e[4]=s*a-i,e[8]=t*a+r,e[1]=o*c,e[5]=r*a+t,e[9]=i*a-s,e[2]=-a,e[6]=h*o,e[10]=n*o}else if("YZX"===t.order){const t=n*o,i=n*a,s=h*o,r=h*a;e[0]=o*l,e[4]=r-t*c,e[8]=s*c+i,e[1]=c,e[5]=n*l,e[9]=-h*l,e[2]=-a*l,e[6]=i*c+s,e[10]=t-r*c}else if("XZY"===t.order){const t=n*o,i=n*a,s=h*o,r=h*a;e[0]=o*l,e[4]=-c,e[8]=a*l,e[1]=t*c+r,e[5]=n*l,e[9]=i*c-s,e[2]=s*c-i,e[6]=h*l,e[10]=r*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(I,t,L)}lookAt(t,e,i){const s=this.elements;return V.subVectors(t,e),0===V.lengthSq()&&(V.z=1),V.normalize(),N.crossVectors(i,V),0===N.lengthSq()&&(1===Math.abs(i.z)?V.x+=1e-4:V.z+=1e-4,V.normalize(),N.crossVectors(i,V)),N.normalize(),q.crossVectors(V,N),s[0]=N.x,s[4]=q.x,s[8]=V.x,s[1]=N.y,s[5]=q.y,s[9]=V.y,s[2]=N.z,s[6]=q.z,s[10]=V.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,r=this.elements,n=i[0],h=i[4],o=i[8],a=i[12],l=i[1],c=i[5],u=i[9],d=i[13],m=i[2],p=i[6],f=i[10],y=i[14],g=i[3],v=i[7],x=i[11],_=i[15],w=s[0],C=s[4],b=s[8],M=s[12],E=s[1],S=s[5],O=s[9],z=s[13],k=s[2],T=s[6],D=s[10],j=s[14],R=s[3],P=s[7],F=s[11],A=s[15];return r[0]=n*w+h*E+o*k+a*R,r[4]=n*C+h*S+o*T+a*P,r[8]=n*b+h*O+o*D+a*F,r[12]=n*M+h*z+o*j+a*A,r[1]=l*w+c*E+u*k+d*R,r[5]=l*C+c*S+u*T+d*P,r[9]=l*b+c*O+u*D+d*F,r[13]=l*M+c*z+u*j+d*A,r[2]=m*w+p*E+f*k+y*R,r[6]=m*C+p*S+f*T+y*P,r[10]=m*b+p*O+f*D+y*F,r[14]=m*M+p*z+f*j+y*A,r[3]=g*w+v*E+x*k+_*R,r[7]=g*C+v*S+x*T+_*P,r[11]=g*b+v*O+x*D+_*F,r[15]=g*M+v*z+x*j+_*A,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],s=t[8],r=t[12],n=t[1],h=t[5],o=t[9],a=t[13],l=t[2],c=t[6],u=t[10],d=t[14];return t[3]*(+r*o*c-s*a*c-r*h*u+i*a*u+s*h*d-i*o*d)+t[7]*(+e*o*d-e*a*u+r*n*u-s*n*d+s*a*l-r*o*l)+t[11]*(+e*a*c-e*h*d-r*n*c+i*n*d+r*h*l-i*a*l)+t[15]*(-s*h*l-e*o*c+e*h*u+s*n*c-i*n*u+i*o*l)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const s=this.elements;return t.isVector3?(s[12]=t.x,s[13]=t.y,s[14]=t.z):(s[12]=t,s[13]=e,s[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],r=t[3],n=t[4],h=t[5],o=t[6],a=t[7],l=t[8],c=t[9],u=t[10],d=t[11],m=t[12],p=t[13],f=t[14],y=t[15],g=c*f*a-p*u*a+p*o*d-h*f*d-c*o*y+h*u*y,v=m*u*a-l*f*a-m*o*d+n*f*d+l*o*y-n*u*y,x=l*p*a-m*c*a+m*h*d-n*p*d-l*h*y+n*c*y,_=m*c*o-l*p*o-m*h*u+n*p*u+l*h*f-n*c*f,w=e*g+i*v+s*x+r*_;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const C=1/w;return t[0]=g*C,t[1]=(p*u*r-c*f*r-p*s*d+i*f*d+c*s*y-i*u*y)*C,t[2]=(h*f*r-p*o*r+p*s*a-i*f*a-h*s*y+i*o*y)*C,t[3]=(c*o*r-h*u*r-c*s*a+i*u*a+h*s*d-i*o*d)*C,t[4]=v*C,t[5]=(l*f*r-m*u*r+m*s*d-e*f*d-l*s*y+e*u*y)*C,t[6]=(m*o*r-n*f*r-m*s*a+e*f*a+n*s*y-e*o*y)*C,t[7]=(n*u*r-l*o*r+l*s*a-e*u*a-n*s*d+e*o*d)*C,t[8]=x*C,t[9]=(m*c*r-l*p*r-m*i*d+e*p*d+l*i*y-e*c*y)*C,t[10]=(n*p*r-m*h*r+m*i*a-e*p*a-n*i*y+e*h*y)*C,t[11]=(l*h*r-n*c*r-l*i*a+e*c*a+n*i*d-e*h*d)*C,t[12]=_*C,t[13]=(l*p*s-m*c*s+m*i*u-e*p*u-l*i*f+e*c*f)*C,t[14]=(m*h*s-n*p*s-m*i*o+e*p*o+n*i*f-e*h*f)*C,t[15]=(n*c*s-l*h*s+l*i*o-e*c*o-n*i*u+e*h*u)*C,this}scale(t){const e=this.elements,i=t.x,s=t.y,r=t.z;return e[0]*=i,e[4]*=s,e[8]*=r,e[1]*=i,e[5]*=s,e[9]*=r,e[2]*=i,e[6]*=s,e[10]*=r,e[3]*=i,e[7]*=s,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],s=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,s))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),s=Math.sin(e),r=1-i,n=t.x,h=t.y,o=t.z,a=r*n,l=r*h;return this.set(a*n+i,a*h-s*o,a*o+s*h,0,a*h+s*o,l*h+i,l*o-s*n,0,a*o-s*h,l*o+s*n,r*o*o+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,s,r,n){return this.set(1,i,r,0,t,1,n,0,e,s,1,0,0,0,0,1),this}compose(t,e,i){const s=this.elements,r=e._x,n=e._y,h=e._z,o=e._w,a=r+r,l=n+n,c=h+h,u=r*a,d=r*l,m=r*c,p=n*l,f=n*c,y=h*c,g=o*a,v=o*l,x=o*c,_=i.x,w=i.y,C=i.z;return s[0]=(1-(p+y))*_,s[1]=(d+x)*_,s[2]=(m-v)*_,s[3]=0,s[4]=(d-x)*w,s[5]=(1-(u+y))*w,s[6]=(f+g)*w,s[7]=0,s[8]=(m+v)*C,s[9]=(f-g)*C,s[10]=(1-(u+p))*C,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}decompose(t,e,i){const s=this.elements;let r=A.set(s[0],s[1],s[2]).length();const n=A.set(s[4],s[5],s[6]).length(),h=A.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),t.x=s[12],t.y=s[13],t.z=s[14],W.copy(this);const o=1/r,a=1/n,l=1/h;return W.elements[0]*=o,W.elements[1]*=o,W.elements[2]*=o,W.elements[4]*=a,W.elements[5]*=a,W.elements[6]*=a,W.elements[8]*=l,W.elements[9]*=l,W.elements[10]*=l,e.setFromRotationMatrix(W),i.x=r,i.y=n,i.z=h,this}makePerspective(t,e,i,s,r,n){void 0===n&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const h=this.elements,o=2*r/(e-t),a=2*r/(i-s),l=(e+t)/(e-t),c=(i+s)/(i-s),u=-(n+r)/(n-r),d=-2*n*r/(n-r);return h[0]=o,h[4]=0,h[8]=l,h[12]=0,h[1]=0,h[5]=a,h[9]=c,h[13]=0,h[2]=0,h[6]=0,h[10]=u,h[14]=d,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this}makeOrthographic(t,e,i,s,r,n){const h=this.elements,o=1/(e-t),a=1/(i-s),l=1/(n-r),c=(e+t)*o,u=(i+s)*a,d=(n+r)*l;return h[0]=2*o,h[4]=0,h[8]=0,h[12]=-c,h[1]=0,h[5]=2*a,h[9]=0,h[13]=-u,h[2]=0,h[6]=0,h[10]=-2*l,h[14]=-d,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const A=new j,W=new F,I=new j(0,0,0),L=new j(1,1,1),N=new j,q=new j,V=new j,B=new F,U=new D;class Z{constructor(t=0,e=0,i=0,s=Z.DefaultOrder){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,s=this._order){return this._x=t,this._y=e,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const s=t.elements,r=s[0],n=s[4],h=s[8],o=s[1],a=s[5],l=s[9],c=s[2],u=s[6],d=s[10];switch(e){case"XYZ":this._y=Math.asin(T(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-l,d),this._z=Math.atan2(-n,r)):(this._x=Math.atan2(u,a),this._z=0);break;case"YXZ":this._x=Math.asin(-T(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(h,d),this._z=Math.atan2(o,a)):(this._y=Math.atan2(-c,r),this._z=0);break;case"ZXY":this._x=Math.asin(T(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-n,a)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-T(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-n,a));break;case"YZX":this._z=Math.asin(T(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,a),this._y=Math.atan2(-c,r)):(this._x=0,this._y=Math.atan2(h,d));break;case"XZY":this._z=Math.asin(-T(n,-1,1)),Math.abs(n)<.9999999?(this._x=Math.atan2(u,a),this._y=Math.atan2(h,r)):(this._x=Math.atan2(-l,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return B.makeRotationFromQuaternion(t),this.setFromRotationMatrix(B,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return U.setFromEuler(this),this.setFromQuaternion(U,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}Z.DefaultOrder="XYZ",Z.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class G{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}class X{constructor(){this.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,s,r,n,h,o,a){const l=this.elements;return l[0]=t,l[1]=s,l[2]=h,l[3]=e,l[4]=r,l[5]=o,l[6]=i,l[7]=n,l[8]=a,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,r=this.elements,n=i[0],h=i[3],o=i[6],a=i[1],l=i[4],c=i[7],u=i[2],d=i[5],m=i[8],p=s[0],f=s[3],y=s[6],g=s[1],v=s[4],x=s[7],_=s[2],w=s[5],C=s[8];return r[0]=n*p+h*g+o*_,r[3]=n*f+h*v+o*w,r[6]=n*y+h*x+o*C,r[1]=a*p+l*g+c*_,r[4]=a*f+l*v+c*w,r[7]=a*y+l*x+c*C,r[2]=u*p+d*g+m*_,r[5]=u*f+d*v+m*w,r[8]=u*y+d*x+m*C,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],s=t[2],r=t[3],n=t[4],h=t[5],o=t[6],a=t[7],l=t[8];return e*n*l-e*h*a-i*r*l+i*h*o+s*r*a-s*n*o}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],r=t[3],n=t[4],h=t[5],o=t[6],a=t[7],l=t[8],c=l*n-h*a,u=h*o-l*r,d=a*r-n*o,m=e*c+i*u+s*d;if(0===m)return this.set(0,0,0,0,0,0,0,0,0);const p=1/m;return t[0]=c*p,t[1]=(s*a-l*i)*p,t[2]=(h*i-s*n)*p,t[3]=u*p,t[4]=(l*e-s*o)*p,t[5]=(s*r-h*e)*p,t[6]=d*p,t[7]=(i*o-a*e)*p,t[8]=(n*e-i*r)*p,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,s,r,n,h){const o=Math.cos(r),a=Math.sin(r);return this.set(i*o,i*a,-i*(o*n+a*h)+n+t,-s*a,s*o,-s*(-a*n+o*h)+h+e,0,0,1),this}scale(t,e){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),s=this.elements,r=s[0],n=s[3],h=s[6],o=s[1],a=s[4],l=s[7];return s[0]=e*r+i*o,s[3]=e*n+i*a,s[6]=e*h+i*l,s[1]=-i*r+e*o,s[4]=-i*n+e*a,s[7]=-i*h+e*l,this}translate(t,e){const i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<9;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}let Y=0;const H=new j,Q=new D,$=new F,J=new j,K=new j,tt=new j,et=new D,it=new j(1,0,0),st=new j(0,1,0),rt=new j(0,0,1),nt={type:"added"},ht={type:"removed"};class ot extends class{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const i=this._listeners[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const i=e.slice(0);for(let e=0,s=i.length;e<s;e++)i[e].call(this,t);t.target=null}}}{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Y++}),this.uuid=function(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,s=4294967295*Math.random()|0;return(O[255&t]+O[t>>8&255]+O[t>>16&255]+O[t>>24&255]+"-"+O[255&e]+O[e>>8&255]+"-"+O[e>>16&15|64]+O[e>>24&255]+"-"+O[63&i|128]+O[i>>8&255]+"-"+O[i>>16&255]+O[i>>24&255]+O[255&s]+O[s>>8&255]+O[s>>16&255]+O[s>>24&255]).toLowerCase()}(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ot.DefaultUp.clone();const t=new j,e=new Z,i=new D,s=new j(1,1,1);e._onChange((function(){i.setFromEuler(e,!1)})),i._onChange((function(){e.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new F},normalMatrix:{value:new X}}),this.matrix=new F,this.matrixWorld=new F,this.matrixAutoUpdate=ot.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new G,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Q.setFromAxisAngle(t,e),this.quaternion.multiply(Q),this}rotateOnWorldAxis(t,e){return Q.setFromAxisAngle(t,e),this.quaternion.premultiply(Q),this}rotateX(t){return this.rotateOnAxis(it,t)}rotateY(t){return this.rotateOnAxis(st,t)}rotateZ(t){return this.rotateOnAxis(rt,t)}translateOnAxis(t,e){return H.copy(t).applyQuaternion(this.quaternion),this.position.add(H.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(it,t)}translateY(t){return this.translateOnAxis(st,t)}translateZ(t){return this.translateOnAxis(rt,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4($.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?J.copy(t):J.set(t,e,i);const s=this.parent;this.updateWorldMatrix(!0,!1),K.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?$.lookAt(K,J,this.up):$.lookAt(J,K,this.up),this.quaternion.setFromRotationMatrix($),s&&($.extractRotation(s.matrixWorld),Q.setFromRotationMatrix($),this.quaternion.premultiply(Q.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(nt)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(ht)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(ht)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),$.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),$.multiply(t.parent.matrixWorld)),t.applyMatrix4($),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,s=this.children.length;i<s;i++){const s=this.children[i].getObjectByProperty(t,e);if(void 0!==s)return s}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(K,t,tt),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(K,et,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].updateMatrixWorld(t)}updateWorldMatrix(t,e){const i=this.parent;if(!0===t&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,i=t.length;e<i;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){const e=void 0===t||"string"==typeof t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const s={};function r(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),!0===this.castShadow&&(s.castShadow=!0),!0===this.receiveShadow&&(s.receiveShadow=!0),!1===this.visible&&(s.visible=!1),!1===this.frustumCulled&&(s.frustumCulled=!1),0!==this.renderOrder&&(s.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(s.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const i=e.shapes;if(Array.isArray(i))for(let e=0,s=i.length;e<s;e++){const s=i[e];r(t.shapes,s)}else r(t.shapes,i)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let i=0,s=this.material.length;i<s;i++)e.push(r(t.materials,this.material[i]));s.material=e}else s.material=r(t.materials,this.material);if(this.children.length>0){s.children=[];for(let e=0;e<this.children.length;e++)s.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let e=0;e<this.animations.length;e++){const i=this.animations[e];s.animations.push(r(t.animations,i))}}if(e){const e=n(t.geometries),s=n(t.materials),r=n(t.textures),h=n(t.images),o=n(t.shapes),a=n(t.skeletons),l=n(t.animations),c=n(t.nodes);e.length>0&&(i.geometries=e),s.length>0&&(i.materials=s),r.length>0&&(i.textures=r),h.length>0&&(i.images=h),o.length>0&&(i.shapes=o),a.length>0&&(i.skeletons=a),l.length>0&&(i.animations=l),c.length>0&&(i.nodes=c)}return i.object=s,i;function n(t){const e=[];for(const i in t){const s=t[i];delete s.metadata,e.push(s)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const i=t.children[e];this.add(i.clone())}return this}}ot.DefaultUp=new j(0,1,0),ot.DefaultMatrixAutoUpdate=!0;class at extends ot{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}class lt{constructor(t=0,e=0,i=0,s=lt.DefaultOrder){this.isEuler=!0,this.th=t,this.sh=e,this.hh=i,this.ih=s,this._onChangeCallback=()=>{},this.eh=()=>{},this.rh=()=>{}}onBeforeGetComponent(t){this.rh=t}onBeforeChange(t){this.eh=t}get _x(){return this.rh(),this.th}set _x(t){this.th=t}get _y(){return this.rh(),this.sh}set _y(t){this.sh=t}get _z(){return this.rh(),this.hh}set _z(t){this.hh=t}get _order(){return this.rh(),this.ih}set _order(t){this.ih=t}get x(){return this.rh(),this.th}set x(t){this.eh(),this.th=t,this._onChangeCallback()}get y(){return this.rh(),this.sh}set y(t){this.eh(),this.sh=t,this._onChangeCallback()}get z(){return this.rh(),this.hh}set z(t){this.eh(),this.hh=t,this._onChangeCallback()}get order(){return this.rh(),this.ih}set order(t){this.eh(),this.ih=t,this._onChangeCallback()}set(t,e,i,s){return this.eh(),this.th=t,this.sh=e,this.hh=i,s&&(this.ih=s),this._onChangeCallback(),this}clone(){return this.rh(),new Z(this.th,this.sh,this.hh,this.ih)}copy(t){return this.eh(),this.th=t._x,this.sh=t._y,this.hh=t._z,this.ih=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e,i=!0){this.rh();const s=t.elements,r=s[0],n=s[4],h=s[8],o=s[1],a=s[5],l=s[9],c=s[2],u=s[6],d=s[10];switch(e||(e=this.ih),this.eh(),e){case"XYZ":this.sh=Math.asin(T(h,-1,1)),Math.abs(h)<.9999999?(this.th=Math.atan2(-l,d),this.hh=Math.atan2(-n,r)):(this.th=Math.atan2(u,a),this.hh=0);break;case"YXZ":this.th=Math.asin(-T(l,-1,1)),Math.abs(l)<.9999999?(this.sh=Math.atan2(h,d),this.hh=Math.atan2(o,a)):(this.sh=Math.atan2(-c,r),this.hh=0);break;case"ZXY":this.th=Math.asin(T(u,-1,1)),Math.abs(u)<.9999999?(this.sh=Math.atan2(-c,d),this.hh=Math.atan2(-n,a)):(this.sh=0,this.hh=Math.atan2(o,r));break;case"ZYX":this.sh=Math.asin(-T(c,-1,1)),Math.abs(c)<.9999999?(this.th=Math.atan2(u,d),this.hh=Math.atan2(o,r)):(this.th=0,this.hh=Math.atan2(-n,a));break;case"YZX":this.hh=Math.asin(T(o,-1,1)),Math.abs(o)<.9999999?(this.th=Math.atan2(-l,a),this.sh=Math.atan2(-c,r)):(this.th=0,this.sh=Math.atan2(h,d));break;case"XZY":this.hh=Math.asin(-T(n,-1,1)),Math.abs(n)<.9999999?(this.th=Math.atan2(u,a),this.sh=Math.atan2(h,r)):(this.th=Math.atan2(-l,d),this.sh=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this.ih=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return ct.makeRotationFromQuaternion(t),this.setFromRotationMatrix(ct,e,i)}setFromVector3(t,e){return this.set(t.x,t.y,t.z,e)}reorder(t){return ut.setFromEuler(this),this.setFromQuaternion(ut,t)}equals(t){return this.rh(),t._x===this.th&&t._y===this.sh&&t._z===this.hh&&t._order===this.ih}fromArray(t){return this.th===t[0]&&this.sh===t[1]&&this.hh===t[2]&&this.ih===t[3]||(this.eh(),this.th=t[0],this.sh=t[1],this.hh=t[2],void 0!==t[3]&&(this.ih=t[3]),this._onChangeCallback()),this}toArray(t=[],e=0){return this.rh(),t[e]=this.th,t[e+1]=this.sh,t[e+2]=this.hh,t[e+3]=this.ih,t}_onChange(t){return this._onChangeCallback=t,this}*[Symbol.iterator](){this.rh(),yield this.th,this.rh(),yield this.sh,this.rh(),yield this.hh,this.rh(),yield this.ih}}lt.DefaultOrder="XYZ",lt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];const ct=new F,ut=new D;class dt{constructor(t=0,e=0,i=0,s=1){this.isQuaternion=!0,this.th=t,this.sh=e,this.hh=i,this.hi=s,this._onChangeCallback=()=>{},this.eh=()=>{},this.rh=()=>{}}onBeforeGetComponent(t){this.rh=t}onBeforeChange(t){this.eh=t}static slerp(t,e,i,s){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(t,e,s)}static slerpFlat(t,e,i,s,r,n,h){let o=i[s+0],a=i[s+1],l=i[s+2],c=i[s+3];const u=r[n+0],d=r[n+1],m=r[n+2],p=r[n+3];if(0===h)return t[e+0]=o,t[e+1]=a,t[e+2]=l,void(t[e+3]=c);if(1===h)return t[e+0]=u,t[e+1]=d,t[e+2]=m,void(t[e+3]=p);if(c!==p||o!==u||a!==d||l!==m){let t=1-h;const e=o*u+a*d+l*m+c*p,i=e>=0?1:-1,s=1-e*e;if(s>Number.EPSILON){const r=Math.sqrt(s),n=Math.atan2(r,e*i);t=Math.sin(t*n)/r,h=Math.sin(h*n)/r}const r=h*i;if(o=o*t+u*r,a=a*t+d*r,l=l*t+m*r,c=c*t+p*r,t===1-h){const t=1/Math.sqrt(o*o+a*a+l*l+c*c);o*=t,a*=t,l*=t,c*=t}}t[e]=o,t[e+1]=a,t[e+2]=l,t[e+3]=c}static multiplyQuaternionsFlat(t,e,i,s,r,n){const h=i[s],o=i[s+1],a=i[s+2],l=i[s+3],c=r[n],u=r[n+1],d=r[n+2],m=r[n+3];return t[e]=h*m+l*c+o*d-a*u,t[e+1]=o*m+l*u+a*c-h*d,t[e+2]=a*m+l*d+h*u-o*c,t[e+3]=l*m-h*c-o*u-a*d,t}get _x(){return this.rh(),this.th}set _x(t){this.th=t}get _y(){return this.rh(),this.sh}set _y(t){this.sh=t}get _z(){return this.rh(),this.hh}set _z(t){this.hh=t}get _w(){return this.rh(),this.hi}set _w(t){this.hi=t}get x(){return this.rh(),this.th}set x(t){this.eh(),this.th=t,this._onChangeCallback()}get y(){return this.rh(),this.sh}set y(t){this.eh(),this.sh=t,this._onChangeCallback()}get z(){return this.rh(),this.hh}set z(t){this.eh(),this.hh=t,this._onChangeCallback()}get w(){return this.rh(),this.hi}set w(t){this.eh(),this.hi=t,this._onChangeCallback()}set(t,e,i,s){return this.eh(),this.th=t,this.sh=e,this.hh=i,this.hi=s,this._onChangeCallback(),this}clone(){return this.rh(),new D(this.th,this.sh,this.hh,this.hi)}copy(t){return this.eh(),this.th=t.x,this.sh=t.y,this.hh=t.z,this.hi=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,s=t._y,r=t._z,n=t._order,h=Math.cos,o=Math.sin,a=h(i/2),l=h(s/2),c=h(r/2),u=o(i/2),d=o(s/2),m=o(r/2);switch(this.eh(),n){case"XYZ":this.th=u*l*c+a*d*m,this.sh=a*d*c-u*l*m,this.hh=a*l*m+u*d*c,this.hi=a*l*c-u*d*m;break;case"YXZ":this.th=u*l*c+a*d*m,this.sh=a*d*c-u*l*m,this.hh=a*l*m-u*d*c,this.hi=a*l*c+u*d*m;break;case"ZXY":this.th=u*l*c-a*d*m,this.sh=a*d*c+u*l*m,this.hh=a*l*m+u*d*c,this.hi=a*l*c-u*d*m;break;case"ZYX":this.th=u*l*c-a*d*m,this.sh=a*d*c+u*l*m,this.hh=a*l*m-u*d*c,this.hi=a*l*c+u*d*m;break;case"YZX":this.th=u*l*c+a*d*m,this.sh=a*d*c+u*l*m,this.hh=a*l*m-u*d*c,this.hi=a*l*c-u*d*m;break;case"XZY":this.th=u*l*c-a*d*m,this.sh=a*d*c-u*l*m,this.hh=a*l*m+u*d*c,this.hi=a*l*c+u*d*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+n)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,s=Math.sin(i);return this.eh(),this.th=t.x*s,this.sh=t.y*s,this.hh=t.z*s,this.hi=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],s=e[4],r=e[8],n=e[1],h=e[5],o=e[9],a=e[2],l=e[6],c=e[10],u=i+h+c;if(this.eh(),u>0){const t=.5/Math.sqrt(u+1);this.hi=.25/t,this.th=(l-o)*t,this.sh=(r-a)*t,this.hh=(n-s)*t}else if(i>h&&i>c){const t=2*Math.sqrt(1+i-h-c);this.hi=(l-o)/t,this.th=.25*t,this.sh=(s+n)/t,this.hh=(r+a)/t}else if(h>c){const t=2*Math.sqrt(1+h-i-c);this.hi=(r-a)/t,this.th=(s+n)/t,this.sh=.25*t,this.hh=(o+l)/t}else{const t=2*Math.sqrt(1+c-i-h);this.hi=(n-s)/t,this.th=(r+a)/t,this.sh=(o+l)/t,this.hh=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return this.eh(),i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this.th=-t.y,this.sh=t.x,this.hh=0,this.hi=i):(this.th=0,this.sh=-t.z,this.hh=t.y,this.hi=i)):(this.th=t.y*e.z-t.z*e.y,this.sh=t.z*e.x-t.x*e.z,this.hh=t.x*e.y-t.y*e.x,this.hi=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(T(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const s=Math.min(1,e/i);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this.rh(),this.eh(),this.th*=-1,this.sh*=-1,this.hh*=-1,this._onChangeCallback(),this}dot(t){return this.rh(),this.th*t._x+this.sh*t._y+this.hh*t._z+this.hi*t._w}lengthSq(){return this.rh(),this.th*this.th+this.sh*this.sh+this.hh*this.hh+this.hi*this.hi}length(){return this.rh(),Math.sqrt(this.th*this.th+this.sh*this.sh+this.hh*this.hh+this.hi*this.hi)}normalize(){let t=this.length();return 0===t?(this.eh(),this.th=0,this.sh=0,this.hh=0,this.hi=1):(t=1/t,this.rh(),this.eh(),this.th=this.th*t,this.sh=this.sh*t,this.hh=this.hh*t,this.hi=this.hi*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):0===t._x&&0===t._y&&0===t._z&&1===t._w?this:this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,s=t._y,r=t._z,n=t._w,h=e._x,o=e._y,a=e._z,l=e._w;return this.eh(),this.th=i*l+n*h+s*a-r*o,this.sh=s*l+n*o+r*h-i*a,this.hh=r*l+n*a+i*o-s*h,this.hi=n*l-i*h-s*o-r*a,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);this.rh();const i=this.th,s=this.sh,r=this.hh,n=this.hi;let h=n*t._w+i*t._x+s*t._y+r*t._z;if(this.eh(),h<0?(this.hi=-t._w,this.th=-t._x,this.sh=-t._y,this.hh=-t._z,h=-h):this.copy(t),h>=1)return this.hi=n,this.th=i,this.sh=s,this.hh=r,this;const o=1-h*h;if(o<=Number.EPSILON){const t=1-e;return this.hi=t*n+e*this.hi,this.th=t*i+e*this.th,this.sh=t*s+e*this.sh,this.hh=t*r+e*this.hh,this.normalize(),this}const a=Math.sqrt(o),l=Math.atan2(a,h),c=Math.sin((1-e)*l)/a,u=Math.sin(e*l)/a;return this.hi=n*c+this.hi*u,this.th=i*c+this.th*u,this.sh=s*c+this.sh*u,this.hh=r*c+this.hh*u,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),s=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(s),i*Math.sin(r),i*Math.cos(r),e*Math.sin(s))}equals(t){return this.rh(),t._x===this.th&&t._y===this.sh&&t._z===this.hh&&t._w===this.hi}fromArray(t,e=0){return this.th===t[e]&&this.sh===t[e+1]&&this.hh===t[e+2]&&this.hi===t[e+3]||(this.eh(),this.th=t[e],this.sh=t[e+1],this.hh=t[e+2],this.hi=t[e+3],this._onChangeCallback()),this}toArray(t=[],e=0){return this.rh(),t[e]=this.th,t[e+1]=this.sh,t[e+2]=this.hh,t[e+3]=this.hi,t}fromBufferAttribute(t,e){return this.th=t.getX(e),this.sh=t.getY(e),this.hh=t.getZ(e),this.hi=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}multiplyVector3(t){throw new Error("deprecated")}inverse(){throw new Error("deprecated")}*[Symbol.iterator](){this.rh(),yield this.th,this.rh(),yield this.sh,this.rh(),yield this.hh,this.rh(),yield this.hi}}class mt{constructor(t=0,e=0,i=0){this.isVector3=!0,this.nh=t,this.ah=e,this.oh=i,this.eh=()=>{},this.rh=()=>{}}onBeforeChange(t){this.eh=t}onBeforeGetComponent(t){this.rh=t}get x(){return this.rh(),this.nh}set x(t){this.eh(),this.nh=t}get y(){return this.rh(),this.ah}set y(t){this.eh(),this.ah=t}get z(){return this.rh(),this.oh}set z(t){this.eh(),this.oh=t}set(t,e,i){return void 0===i&&(this.rh(),i=this.oh),this.eh(),this.nh=t,this.ah=e,this.oh=i,this}setScalar(t){return this.eh(),this.nh=t,this.ah=t,this.oh=t,this}setX(t){return this.eh(),this.nh=t,this}setY(t){return this.eh(),this.ah=t,this}setZ(t){return this.eh(),this.oh=t,this}setComponent(t,e){switch(t){case 0:this.eh(),this.nh=e;break;case 1:this.eh(),this.ah=e;break;case 2:this.eh(),this.oh=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(this.rh(),t){case 0:return this.nh;case 1:return this.ah;case 2:return this.oh;default:throw new Error("index is out of range: "+t)}}clone(){return this.rh(),new j(this.nh,this.ah,this.oh)}copy(t){return this.eh(),this.nh=t.x,this.ah=t.y,this.oh=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(0===t.x&&0===t.y&&0===t.z||(this.rh(),this.eh(),this.nh+=t.x,this.ah+=t.y,this.oh+=t.z),this)}addScalar(t){return 0===t||(this.rh(),this.eh(),this.nh+=t,this.ah+=t,this.oh+=t),this}addVectors(t,e){return this.eh(),this.nh=t.x+e.x,this.ah=t.y+e.y,this.oh=t.z+e.z,this}addScaledVector(t,e){return this.rh(),this.eh(),this.nh+=t.x*e,this.ah+=t.y*e,this.oh+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(0===t.x&&0===t.y&&0===t.z||(this.rh(),this.eh(),this.nh-=t.x,this.ah-=t.y,this.oh-=t.z),this)}subScalar(t){return 0===t||(this.rh(),this.eh(),this.nh-=t,this.ah-=t,this.oh-=t),this}subVectors(t,e){return this.eh(),this.nh=t.x-e.x,this.ah=t.y-e.y,this.oh=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(1===t.x&&1===t.y&&1===t.z||(this.rh(),this.eh(),this.nh*=t.x,this.ah*=t.y,this.oh*=t.z),this)}multiplyScalar(t){return 1===t||(this.rh(),this.eh(),this.nh*=t,this.ah*=t,this.oh*=t),this}multiplyVectors(t,e){return this.eh(),this.nh=t.x*e.x,this.ah=t.y*e.y,this.oh=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(ft.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(ft.setFromAxisAngle(t,e))}applyMatrix3(t){this.rh();const e=this.nh,i=this.ah,s=this.oh,r=t.elements;return this.eh(),this.nh=r[0]*e+r[3]*i+r[6]*s,this.ah=r[1]*e+r[4]*i+r[7]*s,this.oh=r[2]*e+r[5]*i+r[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){this.rh();const e=this.nh,i=this.ah,s=this.oh,r=t.elements,n=1/(r[3]*e+r[7]*i+r[11]*s+r[15]);return this.eh(),this.nh=(r[0]*e+r[4]*i+r[8]*s+r[12])*n,this.ah=(r[1]*e+r[5]*i+r[9]*s+r[13])*n,this.oh=(r[2]*e+r[6]*i+r[10]*s+r[14])*n,this}applyQuaternion(t){this.rh();const e=this.nh,i=this.ah,s=this.oh,r=t.x,n=t.y,h=t.z,o=t.w,a=o*e+n*s-h*i,l=o*i+h*e-r*s,c=o*s+r*i-n*e,u=-r*e-n*i-h*s;return this.eh(),this.nh=a*o+u*-r+l*-h-c*-n,this.ah=l*o+u*-n+c*-r-a*-h,this.oh=c*o+u*-h+a*-n-l*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){this.rh();const e=this.nh,i=this.ah,s=this.oh,r=t.elements;return this.eh(),this.nh=r[0]*e+r[4]*i+r[8]*s,this.ah=r[1]*e+r[5]*i+r[9]*s,this.oh=r[2]*e+r[6]*i+r[10]*s,this.normalize()}divide(t){return 1===t.x&&1===t.y&&1===t.z||(this.rh(),this.eh(),this.nh/=t.x,this.ah/=t.y,this.oh/=t.z),this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.rh(),this.eh(),this.nh=Math.min(this.nh,t.x),this.ah=Math.min(this.ah,t.y),this.oh=Math.min(this.oh,t.z),this}max(t){return this.rh(),this.eh(),this.nh=Math.max(this.nh,t.x),this.ah=Math.max(this.ah,t.y),this.oh=Math.max(this.oh,t.z),this}clamp(t,e){return this.rh(),this.eh(),this.nh=Math.max(t.x,Math.min(e.x,this.nh)),this.ah=Math.max(t.y,Math.min(e.y,this.ah)),this.oh=Math.max(t.z,Math.min(e.z,this.oh)),this}clampScalar(t,e){return this.rh(),this.eh(),this.nh=Math.max(t,Math.min(e,this.nh)),this.ah=Math.max(t,Math.min(e,this.ah)),this.oh=Math.max(t,Math.min(e,this.oh)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.rh(),this.eh(),this.nh=Math.floor(this.nh),this.ah=Math.floor(this.ah),this.oh=Math.floor(this.oh),this}ceil(){return this.rh(),this.eh(),this.nh=Math.ceil(this.nh),this.ah=Math.ceil(this.ah),this.oh=Math.ceil(this.oh),this}round(){return this.rh(),this.eh(),this.nh=Math.round(this.nh),this.ah=Math.round(this.ah),this.oh=Math.round(this.oh),this}roundToZero(){return this.rh(),this.eh(),this.nh=this.nh<0?Math.ceil(this.nh):Math.floor(this.nh),this.ah=this.ah<0?Math.ceil(this.ah):Math.floor(this.ah),this.oh=this.oh<0?Math.ceil(this.oh):Math.floor(this.oh),this}negate(){return this.rh(),this.eh(),this.nh=-this.nh,this.ah=-this.ah,this.oh=-this.oh,this}dot(t){return this.rh(),this.nh*t.x+this.ah*t.y+this.oh*t.z}lengthSq(){return this.rh(),this.nh*this.nh+this.ah*this.ah+this.oh*this.oh}length(){return this.rh(),Math.sqrt(this.nh*this.nh+this.ah*this.ah+this.oh*this.oh)}manhattanLength(){return this.rh(),Math.abs(this.nh)+Math.abs(this.ah)+Math.abs(this.oh)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.rh(),this.eh(),this.nh+=(t.x-this.nh)*e,this.ah+=(t.y-this.ah)*e,this.oh+=(t.z-this.oh)*e,this}lerpVectors(t,e,i){return this.eh(),this.nh=t.x+(e.x-t.x)*i,this.ah=t.y+(e.y-t.y)*i,this.oh=t.z+(e.z-t.z)*i,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,s=t.y,r=t.z,n=e.x,h=e.y,o=e.z;return this.eh(),this.nh=s*o-r*h,this.ah=r*n-i*o,this.oh=i*h-s*n,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return pt.copy(this).projectOnVector(t),this.sub(pt)}reflect(t){return this.sub(pt.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(T(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){this.rh();const e=this.nh-t.x,i=this.ah-t.y,s=this.oh-t.z;return e*e+i*i+s*s}manhattanDistanceTo(t){return this.rh(),Math.abs(this.nh-t.x)+Math.abs(this.ah-t.y)+Math.abs(this.oh-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const s=Math.sin(e)*t;return this.eh(),this.nh=s*Math.sin(i),this.ah=Math.cos(e)*t,this.oh=s*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.eh(),this.nh=t*Math.sin(e),this.ah=i,this.oh=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.eh(),this.nh=e[12],this.ah=e[13],this.oh=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.eh(),this.nh=e,this.ah=i,this.oh=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return this.rh(),t.x===this.nh&&t.y===this.ah&&t.z===this.oh}fromArray(t,e=0){return this.nh===t[e]&&this.ah===t[e+1]&&this.oh===t[e+2]||(this.eh(),this.nh=t[e],this.ah=t[e+1],this.oh=t[e+2]),this}toArray(t=[],e=0){return this.rh(),t[e]=this.nh,t[e+1]=this.ah,t[e+2]=this.oh,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.eh(),this.nh=t.getX(e),this.ah=t.getY(e),this.oh=t.getZ(e),this}random(){return this.eh(),this.nh=Math.random(),this.ah=Math.random(),this.oh=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-Math.pow(t,2));return this.eh(),this.nh=i*Math.cos(e),this.ah=i*Math.sin(e),this.oh=t,this}*[Symbol.iterator](){this.rh(),yield this.nh,this.rh(),yield this.ah,this.rh(),yield this.oh}lengthManhattan(){throw new Error("deprecated")}distanceToManhattan(t){throw new Error("deprecated")}}const pt=new mt,ft=new D;class yt{constructor(t,e,i){this.ts=!1,this.ss=!1,this.es=!1,this.rs=!1,this.hs=!1,this.ns=this.os.bind(this),this.ls=this.fs.bind(this),this.cs=this.us.bind(this),this.ds=this.ps.bind(this),this.vs=this.bs.bind(this),this.Ts=this._s.bind(this),this.Os=this.gs.bind(this),this.Rs=this.xs.bind(this),this.ws=!1,this.isRegisteredToProcessor=!1,this.O=e,this.Ws=i,this.Ms=new yt._transformObject3D,this.Ms.matrixAutoUpdate=!0,this.Ms.userData=this,e.scene.unsafeGetThreeScene().add(this.Ms),Object.defineProperties(this.Ms,{position:{writable:!0},rotation:{writable:!0},quaternion:{writable:!0},scale:{writable:!0}});const s=this.ns,r=this.ls,n=new mt;n.onBeforeGetComponent(s),n.onBeforeChange(r),this.Ms.position=n;const h=new lt;h.onBeforeGetComponent(s),h.onBeforeChange(r),h._onChange(this.cs),this.Ms.rotation=h;const o=new dt;o.onBeforeGetComponent(s),o.onBeforeChange(r),o._onChange(this.ds),this.Ms.quaternion=o;const a=new mt(1,1,1);a.onBeforeGetComponent(s),a.onBeforeChange(r),this.Ms.scale=a,this._t=t;const l=this.vs,c=this.Ts,u=new mt;u.onBeforeGetComponent(l),u.onBeforeChange(c),this.Cs=u;const d=new lt;d.onBeforeGetComponent(l),d.onBeforeChange(c),d._onChange(this.Os),this.ys=d;const m=new dt;m.onBeforeGetComponent(l),m.onBeforeChange(c),m._onChange(this.Rs),this.Fs=m;const p=new mt(1,1,1);p.onBeforeGetComponent(l),p.onBeforeChange(c),this.Vs=p,this.As()}os(){this.ws||this.Ls()}fs(){this.ws||(this.Ls(),this.Ps(),this.hs=!1,this.ss=!0,this.As(),this.Ss(),this.js())}us(){this.ws||this.Ms.quaternion.setFromEuler(this.Ms.rotation,!1)}ps(){this.ws||this.Ms.rotation.setFromQuaternion(this.Ms.quaternion,void 0,!1)}bs(){this.ws||this.Ds()}_s(){this.ws||(this.Ds(),this.Ps(),this.rs=!1,this.hs=!0,this.ss=!0,this.As(),this.Es(),this.js())}gs(){this.ws||this.Fs.setFromEuler(this.ys,!1)}xs(){this.ws||this.ys.setFromQuaternion(this.Fs,void 0,!1)}Ss(){this.rs=!0;const t=this.Ms.children;for(let e=0,i=t.length;e<i;e++){const i=t[e];i.userData instanceof yt&&i.userData.Ss()}}Es(){const t=this.Ms.children;for(let e=0,i=t.length;e<i;e++){const i=t[e];i.userData instanceof yt&&i.userData.Ss()}}As(){this.O.transformMatrixProcessor.enqueueTransformToUpdate(this),this.Us()}Us(){this.es=!0;const t=this.Ms.children;for(let e=0,i=t.length;e<i;e++){const i=t[e];i.userData instanceof yt&&i.userData.Us()}}js(){this.ts=!0;const t=this.Ms.children;for(let e=0,i=t.length;e<i;e++){const i=t[e];i.userData instanceof yt&&i.userData.js()}}Ls(){if(this.hs){if(this.ss){this.es&&(this.ws=!0,this.Ms.matrixWorld.compose(this.Cs,this.Fs,this.Vs),this.ws=!1,this.es=!1,this._t.gameObjectEventContainer.invokeOnWorldMatrixUpdated());const t=this.parent;if(t){t.Qs();const e=yt._matrix4Buffer.copy(t.Ms.matrixWorld).invert();this.Ms.matrix.multiplyMatrices(this.Ms.matrixWorld,e)}else this.Ms.matrix.copy(this.Ms.matrixWorld);this.ss=!1}this.ws=!0,this.Ms.matrix.decompose(this.localPosition,this.localRotation,this.localScale),this.localEulerAngles.setFromQuaternion(this.localRotation,void 0,!1),this.ws=!1,this.hs=!1}}Ds(){this.rs&&(this.Qs(),this.ws=!0,this.Ms.matrixWorld.decompose(this.Cs,this.Fs,this.Vs),this.ys.setFromQuaternion(this.Fs,void 0,!1),this.ws=!1,this.rs=!1)}Qs(){if(!this.es)return;const t=this.Ms.matrix;if(this.ss)if(this.hs)this.ws=!0,this.Ms.matrixWorld.compose(this.Cs,this.Fs,this.Vs),this.ws=!1;else{this.ss&&(this.ws=!0,t.compose(this.localPosition,this.localRotation,this.localScale),this.ws=!1,this.ss=!1);const e=this.parent;e?(e.Qs(),this.Ms.matrixWorld.multiplyMatrices(e.Ms.matrixWorld,t)):this.Ms.matrixWorld.copy(t)}else{const e=this.parent;e?(e.Qs(),this.Ms.matrixWorld.multiplyMatrices(e.Ms.matrixWorld,t)):this.Ms.matrixWorld.copy(t)}this.es=!1,this._t.gameObjectEventContainer.invokeOnWorldMatrixUpdated()}Ns(){if(!this.ss)return;const t=this.Ms.matrix;if(this.es)if(this.rs)this.ws=!0,t.compose(this.localPosition,this.localRotation,this.localScale),this.ws=!1;else{this.es&&(this.ws=!0,this.Ms.matrixWorld.compose(this.Cs,this.Fs,this.Vs),this.ws=!1,this.es=!1,this._t.gameObjectEventContainer.invokeOnWorldMatrixUpdated());const t=this.parent;if(t){t.Qs();const e=yt._matrix4Buffer.copy(t.Ms.matrixWorld).invert();this.Ms.matrix.multiplyMatrices(this.Ms.matrixWorld,e)}else this.Ms.matrix.copy(this.Ms.matrixWorld)}else{const t=this.parent;if(t){t.Qs();const e=yt._matrix4Buffer.copy(t.Ms.matrixWorld).invert();this.Ms.matrix.multiplyMatrices(this.Ms.matrixWorld,e)}else this.Ms.matrix.copy(this.Ms.matrixWorld)}this.ss=!1}Bs(){this.Ls();const t=this.Ms.children;for(let e=0,i=t.length;e<i;e++){const i=t[e];i.userData instanceof yt&&i.userData.Bs()}}Ps(){const t=this.Ms.children;for(let e=0,i=t.length;e<i;e++){const i=t[e];i.userData instanceof yt&&(i.userData.Ls(),i.userData.Ps())}}tryUpdateWorldMatrixRecursivelyFromThisToChildren(){return!!this._t.exists&&this.qs()}qs(){this.Qs();const t=this.Ms.children;for(let e=0,i=t.length;e<i;e++){const i=t[e];i.userData instanceof yt&&i.userData.qs()}return!0}foreachChild(t){const e=this.Ms.children;for(let i=0,s=e.length;i<s;i++){const s=e[i];s.userData instanceof yt&&t(s.userData)}}iterateChild(t){const e=this.Ms.children;for(let i=0,s=e.length;i<s;i++){const s=e[i];if(s.userData instanceof yt&&!t(s.userData))break}}get parent(){return this.Ms.parent instanceof at?null:this.Ms.parent.userData}set parent(t){this.setParent(t)}setParent(t,e=!0){if(t){const i=this.parent;this.Bs(),this.As(),this.Ss(),e&&t.getWorldToLocalMatrix(this.Ms.matrix).multiply(this.Ms.matrixWorld),this.Ms.removeFromParent(),t.Ms.add(this.Ms),this.Ws(i,t)}else{const t=this.parent;this.Bs(),this.As(),this.Ss(),e&&this.Ms.matrix.copy(this.Ms.matrixWorld),this.Ms.removeFromParent(),this.O.scene.unsafeGetThreeScene().add(this.Ms),this.Ws(t,null)}}get children(){return this.Ms.children.filter((t=>t.userData instanceof yt)).map((t=>t.userData))}get gameObject(){return this._t}getForward(t){this.Qs();const e=this.Ms.matrixWorld.elements;return t?t.set(e[8],e[9],e[10]):new j(e[8],e[9],e[10])}setForward(t){this.O.transformMatrixProcessor.enqueueTransformToUpdate(this),this.Qs(),this.Ps(),this.ss=!0,this.hs=!0,this.Es(),this.Ss(),this.rs=!0;const e=this.Ms.matrixWorld.elements,i=yt._vector3Buffer.copy(t).normalize();e[8]=i.x,e[9]=i.y,e[10]=i.z}getRight(t){this.Qs();const e=this.Ms.matrixWorld.elements;return t?t.set(e[0],e[1],e[2]):new j(e[0],e[1],e[2])}setRight(t){this.O.transformMatrixProcessor.enqueueTransformToUpdate(this),this.Qs(),this.Ps(),this.ss=!0,this.hs=!0,this.Es(),this.Ss(),this.rs=!0;const e=this.Ms.matrixWorld.elements,i=yt._vector3Buffer.copy(t).normalize();e[0]=i.x,e[1]=i.y,e[2]=i.z}getUp(t){this.Qs();const e=this.Ms.matrixWorld.elements;return t?t.set(e[4],e[5],e[6]):new j(e[4],e[5],e[6])}setUp(t){this.O.transformMatrixProcessor.enqueueTransformToUpdate(this),this.Qs(),this.Ps(),this.ss=!0,this.hs=!0,this.Es(),this.Ss(),this.rs=!0;const e=this.Ms.matrixWorld.elements,i=yt._vector3Buffer.copy(t).normalize();e[4]=i.x,e[5]=i.y,e[6]=i.z}get localPosition(){return this.Ms.position}get localEulerAngles(){return this.Ms.rotation}get localRotation(){return this.Ms.quaternion}get localScale(){return this.Ms.scale}get position(){return this.Cs}get eulerAngles(){return this.ys}get rotation(){return this.Fs}get lossyScale(){return this.Vs}get hasChanged(){return this.ts}set hasChanged(t){this.ts=t}getWorldToLocalMatrix(t){return this.Qs(),t?t.copy(this.Ms.matrixWorld).invert():this.Ms.matrixWorld.clone().invert()}getLocalToWorldMatrix(t){return this.Qs(),t?t.copy(this.Ms.matrixWorld):this.Ms.matrixWorld.clone()}transformPoint(t){return this.Qs(),this.Ms.localToWorld(t)}inverseTransformPoint(t){return this.Qs(),this.Ms.worldToLocal(t)}transformDirection(t){const e=yt._matrix4Buffer.copy(this.Ms.matrixWorld).makeScale(1,1,1);return t.transformDirection(e)}inverseTransformDirection(t){const e=yt._matrix4Buffer.copy(this.Ms.matrixWorld).makeScale(1,1,1).invert();return t.transformDirection(e)}transformVector(t){return t.transformDirection(this.Ms.matrixWorld)}inverseTransformVector(t){return t.transformDirection(yt._matrix4Buffer.copy(this.Ms.matrixWorld).invert())}isChildOf(t){if(this===t)return!0;const e=this.parent;return!!e&&e.isChildOf(t)}lookAt(t){const e=this.parent;yt._vector3Buffer.setFromMatrixPosition(this.Ms.matrixWorld);const i=yt._matrix4Buffer.lookAt(yt._vector3Buffer,t,this.Ms.up);if(this.Ms.quaternion.setFromRotationMatrix(i),e){i.extractRotation(e.Ms.matrixWorld);const t=yt._quaternionBuffer.setFromRotationMatrix(i);this.Ms.quaternion.premultiply(t.invert())}}setRotationFromAxisAngle(t,e){this.Ms.setRotationFromAxisAngle(t,e)}setRotationFromEuler(t){this.Ms.setRotationFromEuler(t)}setRotationFromMatrix(t){this.Ms.setRotationFromMatrix(t)}setRotationFromQuaternion(t){this.Ms.setRotationFromQuaternion(t)}rotateOnAxis(t,e){return this.Ms.rotateOnAxis(t,e),this}rotateOnWorldAxis(t,e){return this.Ms.rotateOnWorldAxis(t,e),this}rotateX(t){return this.Ms.rotateX(t),this}rotateY(t){return this.Ms.rotateY(t),this}rotateZ(t){return this.Ms.rotateZ(t),this}translateOnAxis(t,e){return this.Ms.translateOnAxis(t,e),this}translateX(t){return this.Ms.translateX(t),this}translateY(t){return this.Ms.translateY(t),this}translateZ(t){return this.Ms.translateZ(t),this}unsafeGetObject3D(){return this.Ms}enqueueRenderAttachedObject3D(t){this.O.transformMatrixProcessor.enqueueRenderObject(t)}dequeueRenderAttachedObject3D(t){this.O.transformMatrixProcessor.dequeueRenderObject(t)}static updateRawObject3DWorldMatrixRecursively(t){t.matrixAutoUpdate&&t.updateMatrix(),t.parent?t.matrixWorld.multiplyMatrices(t.parent.matrixWorld,t.matrix):t.matrixWorld.copy(t.matrix);const e=t.children;for(let t=0,i=e.length;t<i;t++)yt.updateRawObject3DWorldMatrixRecursivelyInternal(e[t])}static updateRawObject3DWorldMatrixRecursivelyInternal(t){t.matrixAutoUpdate&&t.updateMatrix(),t.matrixWorld.multiplyMatrices(t.parent.matrixWorld,t.matrix);const e=t.children;for(let t=0,i=e.length;t<i;t++)yt.updateRawObject3DWorldMatrixRecursivelyInternal(e[t])}toJSON(){return{}}}yt._transformObject3D=class extends ot{updateMatrix(){this.userData.Ns()}updateMatrixWorld(t){this.userData.Qs()}updateWorldMatrix(t,e){if(this.userData.Qs(),e){const t=this.children;for(let e=0,i=t.length;e<i;e++)t[e].updateWorldMatrix(!1,!0)}}},yt._matrix4Buffer=new F,yt._vector3Buffer=new j,yt._quaternionBuffer=new D;class gt{constructor(t,e){this.$t=!1,this.O=t,this.yt=t.instantiater.generateId(),this.Mt=!0,this.Nt=!0,this._initialized=!1,this.components=[],this.gameObjectEventContainer=new S,this.Qt=new yt(this,t,this.Vt.bind(this)),this.Qt.unsafeGetObject3D().name=e}addChildFromBuilder(t){this.Xt();const e=t.build(this.transform);return t.processEvent(),e}Vt(t,e){if(e&&this.O!==e.gameObject.O)throw new Error("can't change parent to another engine instance");const i=this.transform.gameObject;e?i.Nt&&i.Zt(e.gameObject.Mt):i.Zt(i.Nt)}addComponent(t){this.Xt();const e=new t(this);if(e.engine_internal_constructAfterProcess(),e.disallowMultipleComponent&&this.getComponent(t))return console.warn(`Component ${t.name} already exists on GameObject ${this.name}`),null;const i=e.requiredComponents;for(let e=0;e<i.length;e++){const s=i[e];if(!this.getComponent(s))return console.warn(`Component ${s.name} is required by Component ${t.name} on GameObject ${this.name}`),null}return this.components.push(e),this.gameObjectEventContainer.registerComponent(e),this.Mt&&e.enabled&&(e._engine_internal_componentEventContainer.tryCallAwake(),e._engine_internal_componentEventContainer.tryRegisterOnEnable(),e._engine_internal_componentEventContainer.tryRegisterStart(),e._engine_internal_componentEventContainer.tryRegisterUpdate(),this.O.sceneProcessor.tryStartProcessSyncedEvent()),e}getComponent(t){this.Xt();const e=this.components;for(let i=0;i<e.length;i++){const s=e[i];if(s instanceof t)return s}return null}getComponents(t){if(this.Xt(),!t)return this.components.slice();const e=this.components,i=[];for(let s=0;s<e.length;s++){const r=e[s];r instanceof t&&i.push(r)}return i}getComponentInChildren(t){this.Xt();const e=this.getComponent(t);if(e)return e;let i=null;return this.Qt.iterateChild((e=>{const s=e.gameObject.getComponentInChildren(t);return!s||(i=s,!1)})),i}getComponentsInChildren(t){if(this.Xt(),t){const e=this.getComponents(t);return this.Qt.foreachChild((i=>{const s=i.gameObject.getComponentsInChildren(t);e.push(...s)})),e}{const t=this.getComponents();return this.Qt.foreachChild((e=>{t.push(...e.gameObject.getComponentsInChildren())})),t}}foreachComponent(t,e){this.Xt();const i=this.components;if(e)for(let s=0;s<i.length;s++){const r=i[s];r instanceof e&&t(r)}else for(let e=0;e<i.length;e++)t(i[e])}foreachComponentInChildren(t,e){this.Xt(),e?(this.foreachComponent(t,e),this.Qt.foreachChild((i=>{i.gameObject.foreachComponentInChildren(t,e)}))):(this.foreachComponent(t),this.Qt.foreachChild((e=>{e.gameObject.foreachComponentInChildren(t)})))}destroy(){gt.destroyRecursively(this),this.O.sceneProcessor.tryStartProcessSyncedEvent(),this.O.sceneProcessor.addRemoveGameObject(this)}static destroyRecursively(t){t.$t||(t.$t=!0,t.te(),t.Qt.children.forEach((t=>{t instanceof yt&&gt.destroyRecursively(t.gameObject)})))}te(){const t=this.components;for(let e=0;e<t.length;e++){const i=t[e];i._engine_internal_destroyed||(i.enabled&&this.Mt&&(i._engine_internal_componentEventContainer.tryRegisterOnDisable(),i._engine_internal_componentEventContainer.tryUnregisterStart(),i._engine_internal_componentEventContainer.tryUnregisterUpdate()),i.stopAllCoroutines(),i._engine_internal_componentEventContainer.tryRegisterOnDestroy(),i._engine_internal_destroyed=!0)}}removeFromParent(){this.Qt.unsafeGetObject3D().removeFromParent()}removeComponent(t){const e=this.components.indexOf(t);e>=0&&this.components.splice(e,1),this.gameObjectEventContainer.unregisterComponent(t)}get engine(){return this.O}get activeInHierarchy(){return this.Mt}set activeInHierarchy(t){if(this.Mt!==t){if(this.Mt=t,this._initialized){const t=this.components;if(this.Mt)for(let e=0;e<t.length;e++){const i=t[e];i.enabled&&(i._engine_internal_componentEventContainer.tryCallAwake(),i._engine_internal_componentEventContainer.tryRegisterOnEnable(),i._engine_internal_componentEventContainer.tryRegisterStart(),i._engine_internal_componentEventContainer.tryRegisterUpdate())}else for(let e=0;e<t.length;e++){const i=t[e];i.enabled&&(i._engine_internal_componentEventContainer.tryRegisterOnDisable(),i._engine_internal_componentEventContainer.tryUnregisterUpdate(),i.stopAllCoroutines())}}this.Qt.foreachChild((t=>{const e=t.gameObject;this.Mt?e.activeInHierarchy=e.Nt:e.activeInHierarchy=!1}))}}Zt(t){this.Mt!==t&&(this.activeInHierarchy=t,this._initialized&&this.O.sceneProcessor.tryStartProcessSyncedEvent())}get activeSelf(){return this.Nt}set activeSelf(t){this.Xt(),this.Nt!==t&&(this.Nt=t,this.Qt.parent instanceof yt?this.Qt.parent.gameObject.Mt?this.Zt(this.Nt):this.Zt(!1):this.Zt(this.Nt))}get transform(){return this.Qt}get name(){return this.Qt.unsafeGetObject3D().name}set name(t){this.Xt(),this.Qt.unsafeGetObject3D().name=t}get instanceId(){return this.yt}get initialized(){return this._initialized}get exists(){return!this.$t}Xt(){if(this.$t)throw new Error("GameObject "+this.name+" is destroyed")}}class vt{constructor(t,e,i,s,r){this.ee=!1,this._t=new gt(t,e);const n=this._t.transform;i&&n.localPosition.copy(i),s&&n.localRotation.copy(s),r&&n.localScale.copy(r),this.V=[],this.ie=[]}active(t){return this._t.activeSelf=t,this}getGameObject(t){return t.ref=this._t,this}getComponent(t,e){return e.ref=this._t.getComponent(t),this}getComponents(t,e){return t.ref=e?this._t.getComponents(e):this._t.getComponents(),this}getComponentInChildren(t,e){return e.ref=this._t.getComponentInChildren(t),this}getComponentsInChildren(t,e){return t.ref=e?this._t.getComponentsInChildren(e):this._t.getComponentsInChildren(),this}withComponent(t,e){const i=new t(this._t);return i.engine_internal_constructAfterProcess(),i.disallowMultipleComponent&&this._t.getComponent(t)?(console.warn(`Component ${t.name} already exists on GameObject ${this._t.name}`),this):(this._t.components.push(i),this._t.gameObjectEventContainer.registerComponent(i),e&&this.ie.push((()=>e(i))),this)}withChild(t){return this.V.push(t),this}se(t){let e=!1;const i=t.components;for(let s=0;s<i.length;s++){const r=i[s],n=r.requiredComponents;for(let i=0;i<n.length;i++){const s=n[i];t.getComponent(s)||(console.warn(`Component ${s.name} is required by Component ${r.constructor.name} on GameObject ${t.name}`),t.removeComponent(r),e=!0)}}e&&this.se(t)}build(t){if(this.ee)throw new Error("GameObjectBuilder is already built");return this.ee=!0,this.ne(t),this.oe(),this.re(),this._t}ne(t){this._t.transform.setParent(t,!1);const e=this.V;for(let t=0;t<e.length;t++)e[t].ne(this._t.transform)}oe(){this.se(this._t);const t=this.V;for(let e=0;e<t.length;e++)t[e].oe()}re(){const t=this.ie;for(let e=0;e<t.length;e++)t[e]();const e=this.V;for(let t=0;t<e.length;t++)e[t].re();this._t._initialized=!0}processEvent(){vt.processEventByGroup([this],this._t.engine.sceneProcessor)}static processEventByGroup(t,e){const i=[];for(let e=0;e<t.length;e++)i.push(...t[e]._t.getComponentsInChildren());for(let t=0;t<i.length;t++){const e=i[t];e.gameObject.activeInHierarchy&&e.enabled&&e._engine_internal_componentEventContainer.tryCallAwake()}for(let t=0;t<i.length;t++){const e=i[t];e._engine_internal_destroyed||e.gameObject.activeInHierarchy&&e.enabled&&(e._engine_internal_componentEventContainer.tryRegisterOnEnable(),e._engine_internal_componentEventContainer.tryRegisterStart(),e._engine_internal_componentEventContainer.tryRegisterUpdate())}e.tryStartProcessSyncedEvent()}}class xt{constructor(t){this.B=0,this._=0,this.O=t}generateId(){const t=this.B;return this.B+=1,t}generateEventId(){const t=this._;return this._+=1,t}buildGameObject(t,e,i,s){return new vt(this.O,t,e,i,s)}buildPrefab(t,e,i,s,r){return new e(this.O,t,i,s,r)}}class _t{constructor(t,e,i,s,r,n,h,o,a,l){this.t=t,this.i=e,this.h=i,this.o=s,this.u=r,this.g=n,this.p=h,this.m=o,this.l=a,this.I=new v(l),this.P=new xt(this)}applyGameSetting(t){this.l.applyPhysicsSettings(t.physics)}dispose(){this.I.dispose()}get scene(){return this.t}get cameraContainer(){return this.i}get screen(){return this.u}get input(){return this.I}get time(){return this.h}get physics(){return this.l}get gameState(){return this.o}get instantiater(){return this.P}get sceneProcessor(){return this.g}get coroutineProcessor(){return this.p}get transformMatrixProcessor(){return this.m}get physics2DProcessor(){return this.l}}class wt{constructor(t){this.k=t}get kind(){return this.k}set kind(t){this.k=t}}var Ct,bt;(bt=Ct||(Ct={}))[bt.WaitingForStart=0]="WaitingForStart",bt[bt.Initializing=1]="Initializing",bt[bt.Running=2]="Running",bt[bt.Stopped=3]="Stopped",bt[bt.Finalizing=4]="Finalizing",bt[bt.Finalized=5]="Finalized";class Mt{constructor(){this.ce=new at,this.ce.matrixAutoUpdate=!1,this.ce.autoUpdate=!1}addChildFromBuilder(t){const e=t.build(null);return t.processEvent(),e}foreachChild(t){const e=this.ce.children;for(let i=0,s=e.length;i<s;i++){const s=e[i];s.userData instanceof yt&&t(s.userData)}}iterateChild(t){const e=this.ce.children;for(let i=0,s=e.length;i<s;i++){const s=e[i];if(s.userData instanceof yt&&!t(s.userData))break}}get children(){return this.ce.children.filter((t=>t.userData instanceof yt)).map((t=>t.userData))}unsafeGetThreeScene(){return this.ce}}class Et{constructor(t=0,e=0){this.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6],this.y=s[1]*e+s[4]*i+s[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),s=Math.sin(e),r=this.x-t.x,n=this.y-t.y;return this.x=r*i-n*s+t.x,this.y=r*s+n*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class St{constructor(){this.wi=null,this.yi=8,this.Pi=3,this.mi=!0,this.Ei=null,this.pi=null,this.Si=new Map,this.Ti=null,this.Ii=null,this.reuseCollisionCallbacks=!0,this.xi=null,this.Ni=null}applyPhysicsSettings(t){var e;if(!t.loader)return;this.Ti=t.loader,this.pi=new this.Ti.World(new this.Ti.Vec2(0,-9.81));const i=class extends this.Ti.ContactListener{constructor(t){super(),this.Bi=t,this.Oi=new this.Bi.Ti.Collision2DPool,this.Li=new this.Bi.Ti.TriggerEventPool,this.Mi=new this.Bi.Ti.CollisionEventPool}BeginContact(t){const e=t.GetFixtureA().GetUserData(),i=t.GetFixtureB().GetUserData();if(e.isTrigger||i.isTrigger)this.Li.insert(0,e,i);else if(this.Bi.reuseCollisionCallbacks){const s=this.Oi.getInstance();s.setData(t),this.Mi.insert(0,e,i,s,this.Oi)}else{const s=new this.Bi.Ti.Collision2D;s.setData(t),this.Mi.insert(0,e,i,s)}}EndContact(t){const e=t.GetFixtureA().GetUserData(),i=t.GetFixtureB().GetUserData();if(e.isTrigger||i.isTrigger)this.Li.insert(2,e,i);else if(this.Bi.reuseCollisionCallbacks){const s=this.Oi.getInstance();s.setData(t),this.Mi.insert(2,e,i,s,this.Oi)}else{const s=new this.Bi.Ti.Collision2D;s.setData(t),this.Mi.insert(2,e,i,s)}}PreSolve(t,e){const i=t.GetFixtureA().GetUserData(),s=t.GetFixtureB().GetUserData();if(i.isTrigger||s.isTrigger)this.Li.insert(1,i,s);else if(this.Bi.reuseCollisionCallbacks){const e=this.Oi.getInstance();e.setData(t),this.Mi.insert(1,i,s,e,this.Oi)}else{const e=new this.Bi.Ti.Collision2D;e.setData(t),this.Mi.insert(1,i,s,e)}}onTriggerInvoke(){this.Li.invoke()}onCollisionInvoke(){this.Mi.invoke()}},s=new i(this);this.Ii=s,this.pi.SetContactListener(s),t.gravity&&(null===(e=this.pi)||void 0===e||e.SetGravity(t.gravity)),t.defaultMaterial&&(this.wi=t.defaultMaterial.clone()),t.velocityIterations&&(this.yi=t.velocityIterations),t.positionIterations&&(this.Pi=t.positionIterations),t.queriesHitTriggers&&(this.mi=t.queriesHitTriggers),t.reuseCollisionCallbacks&&(this.reuseCollisionCallbacks=t.reuseCollisionCallbacks),t.collisionLayerMaskMatrix?this.Ei=new this.Ti.CollisionLayerMaskConverter(t.collisionLayerMaskMatrix):this.Ei=new this.Ti.CollisionLayerMaskConverter({default:{default:!0}}),this.xi=new this.Ti.RayCastOneCallback(this),this.Ni=new this.Ti.RayCastFilterCallback}update(t){if(this.pi){{let t=this.pi.GetBodyList();for(;t;){const e=t;t=t.GetNext();const i=e.GetUserData().gameObject.transform,s=i.position,r=i.eulerAngles,n=e.GetPosition(),h=e.GetAngle();s.x===n.x&&s.y===n.y||(e.SetPosition(s),e.SetAwake(!0)),r.z!==h&&(e.SetAngle(r.z),e.SetAwake(!0))}}this.pi.Step(t,this.yi,this.Pi);{let t=this.pi.GetBodyList();for(;t;){const e=t;t=t.GetNext();const i=e.GetUserData().gameObject.transform;i.position.x=e.GetPosition().x,i.position.y=e.GetPosition().y,i.eulerAngles.z=e.GetAngle()}}this.Ii.onTriggerInvoke(),this.Ii.onCollisionInvoke()}}addRigidBody(t,e,i){if(!this.pi)throw new Error("Physics2D is not loaded.");let s=this.Si.get(t);if(s){const t=s.addRigidBody(e),r=t.body;return r.SetType(i.type),r.SetPosition(i.position),r.SetAngle(i.angle),r.SetLinearVelocity(i.linearVelocity),r.SetAngularVelocity(i.angularVelocity),r.SetLinearDamping(i.linearDamping),r.SetAngularDamping(i.angularDamping),r.SetSleepingAllowed(i.allowSleep),r.SetAwake(i.awake),r.SetFixedRotation(i.fixedRotation),r.SetBullet(i.bullet),r.SetEnabled(i.enabled),r.SetUserData(i.userData),r.SetGravityScale(i.gravityScale),t}return s=new this.Ti.PhysicsObject2D(t,this.pi.CreateBody(i),(()=>this.Si.delete(t))),this.Si.set(t,s),s.addRigidBody(e)}removeRigidBody(t){const e=this.Si.get(t);if(!e)throw new Error("PhysicsObject2D not found");e.removeRigidBody()}Ri(t){const e=new this.Ti.BodyDef;return e.type=this.Ti.BodyType.b2_kinematicBody,e.position.x=t.transform.position.x,e.position.y=t.transform.position.y,e.angle=t.transform.eulerAngles.z,e}addCollider(t,e){if(!this.pi)throw new Error("Physics2D is not loaded.");let i=this.Si.get(t);return i||(i=new this.Ti.PhysicsObject2D(t,this.pi.CreateBody(this.Ri(t)),(()=>this.Si.delete(t)))),this.Si.set(t,i),i.addCollider(e)}removeCollider(t,e,i){const s=this.Si.get(t);if(!s)throw new Error("PhysicsObject2D not found");s.removeCollider(e,i)}get physicsLoader(){return this.Ti}get gravity(){if(!this.pi)throw new Error("Physics2D is not loaded.");const t=this.pi.GetGravity();return new Et(t.x,t.y)}set gravity(t){if(!this.pi)throw new Error("Physics2D is not loaded.");this.pi.SetGravity(new this.Ti.Vec2(t.x,t.y))}get defaultMaterial(){return this.wi}get velocityIterations(){return this.yi}set velocityIterations(t){this.yi=t}get positionIterations(){return this.Pi}set positionIterations(t){this.Pi=t}get maxLinearCorrection(){if(!this.Ti)throw new Error("Physics2D is not loaded.");return this.Ti.maxLinearCorrection}get maxAngularCorrection(){if(!this.Ti)throw new Error("Physics2D is not loaded.");return this.Ti.maxAngularCorrection}get maxTranslationSpeed(){if(!this.Ti)throw new Error("Physics2D is not loaded.");return this.Ti.maxTranslation}get maxRotationSpeed(){if(!this.Ti)throw new Error("Physics2D is not loaded.");return this.Ti.maxRotation}get baumgarteScale(){if(!this.Ti)throw new Error("Physics2D is not loaded.");return this.Ti.baumgarte}get baumgarteTimeOfImpactScale(){if(!this.Ti)throw new Error("Physics2D is not loaded.");return this.Ti.toiBaumgarte}get timeToSleep(){if(!this.Ti)throw new Error("Physics2D is not loaded.");return this.Ti.timeToSleep}get linearSleepTolerance(){if(!this.Ti)throw new Error("Physics2D is not loaded.");return this.Ti.linearSleepTolerance}get angularSleepTolerance(){if(!this.Ti)throw new Error("Physics2D is not loaded.");return this.Ti.angularSleepTolerance}get queriesHitTriggers(){return this.mi}set queriesHitTriggers(t){this.mi=t}get collisionLayerMask(){return this.Ei}raycastOne(t,e,i,s=Number.POSITIVE_INFINITY,r=4294967295,n=Number.NEGATIVE_INFINITY,h=Number.POSITIVE_INFINITY){if(!this.pi)throw new Error("Physics2D is not loaded.");i||(i=new this.Ti.RaycastHit2D);const o=St._raycastEndPoint.copy(e).multiplyScalar(s===Number.POSITIVE_INFINITY?1e7:s).add(t);return this.xi.setRaycastData(i,t,r,n,h),this.pi.RayCast(this.xi,t,o),this.xi.hit?i:null}raycast(t,e,i,s,r=Number.POSITIVE_INFINITY){if(!this.pi)throw new Error("Physics2D is not loaded.");const n=St._raycastEndPoint.copy(e).multiplyScalar(r===Number.POSITIVE_INFINITY?1e7:r).add(t);return this.Ni.setRaycastData(s,t,i),this.pi.RayCast(this.Ni,t,n),this.Ni.hitCount}}St._raycastEndPoint=new Et;class Ot{constructor(t){this.Wi=null,this.Xi=new Map,this.Yi=new C(void 0,((t,e)=>t.info.priority===e.info.priority?t.camera.instanceId-e.camera.instanceId:t.info.priority-e.info.priority)),this.Zi=t}get camera(){var t,e;return null!==(e=null===(t=this.Wi)||void 0===t?void 0:t.camera)&&void 0!==e?e:null}get currentCameraPriority(){var t,e;return null!==(e=null===(t=this.Wi)||void 0===t?void 0:t.info.priority)&&void 0!==e?e:Number.MIN_SAFE_INTEGER}addCamera(t,e){this.Xi.set(t,e),this.Yi.insert({camera:t,info:e}),this.$i()}removeCamera(t){const e=this.Xi.get(t);e&&(this.Yi.eraseElementByValue({camera:t,info:e}),this.Xi.delete(t),this.$i())}changeCameraPriority(t,e){const i=this.Xi.get(t);i&&(this.Yi.eraseElementByValue({camera:t,info:i}),i.priority=e,this.Yi.insert({camera:t,info:i}),this.$i())}changeCameraBackgroundColor(t,e){var i;const s=this.Xi.get(t);s&&(s.backgroundColor=e,(null===(i=this.Wi)||void 0===i?void 0:i.camera)===t&&this.Zi(e))}$i(){if(0===this.Yi.size())return void(this.Wi=null);const t=this.Yi.front();t?(this.Wi=t,this.Zi(this.Wi.info.backgroundColor)):this.Wi=null}}class zt{constructor(t,e){this._e=t,this.ze=e,this.Ne=new g}get width(){return this._e}get height(){return this.ze}get onResize(){return this.Ne}resize(t,e){this._e=t,this.ze=e,this.Ne.invoke(t,e)}}const kt=new j,Tt=new D,Dt=new j,jt=new F,Rt=new F;class Pt{constructor(){this._e=0,this.ze=0,this.Te=0,this.We=0,this.Ze={camera:{fov:0,style:""}};const t=document.createElement("div");t.style.overflow="hidden",this.domElement=t,this.qe=document.createElement("div"),this.qe.style.transformStyle="preserve-3d",this.qe.style.pointerEvents="none",this.domElement.appendChild(this.qe)}getSize(){return{width:this._e,height:this.ze}}render(t,e,i){const s=i.projectionMatrix.elements[5]*this.We;let r,n;this.Ze.camera.fov!==s&&(this.domElement.style.perspective=i.isPerspectiveCamera?s+"px":"",this.Ze.camera.fov=s),!0===e.autoUpdate&&e.updateMatrixWorld(),null===i.parent&&i.updateMatrixWorld(),i.isOrthographicCamera?(r=-(i.right+i.left)/2,n=(i.top+i.bottom)/2):(r=1,n=1);const h=(i.isOrthographicCamera?"scale("+s+")translate("+this.Ae(r)+"px,"+this.Ae(n)+"px)"+this.Be(i.matrixWorldInverse):"translateZ("+s+"px)"+this.Be(i.matrixWorldInverse))+"translate("+this.Te+"px,"+this.We+"px)";this.Ze.camera.style!==h&&(this.qe.style.transform=h,this.Ze.camera.style=h);for(const s of t)this.Ge(s,e,i)}setSize(t,e){this._e=t,this.ze=e,this.Te=this._e/2,this.We=this.ze/2,this.domElement.style.width=t+"px",this.domElement.style.height=e+"px",this.qe.style.width=t+"px",this.qe.style.height=e+"px"}Ae(t){return Math.abs(t)<1e-10?0:t}Be(t){const e=t.elements,i=this.Ae;return"matrix3d("+i(e[0])+","+i(-e[1])+","+i(e[2])+","+i(e[3])+","+i(e[4])+","+i(-e[5])+","+i(e[6])+","+i(e[7])+","+i(e[8])+","+i(-e[9])+","+i(e[10])+","+i(e[11])+","+i(e[12])+","+i(-e[13])+","+i(e[14])+","+i(e[15])+")"}He(t){const e=t.elements,i=this.Ae;return"translate(-50%,-50%)matrix3d("+i(e[0])+","+i(e[1])+","+i(e[2])+","+i(e[3])+","+i(-e[4])+","+i(-e[5])+","+i(-e[6])+","+i(-e[7])+","+i(e[8])+","+i(e[9])+","+i(e[10])+","+i(e[11])+","+i(e[12])+","+i(e[13])+","+i(e[14])+","+i(e[15])+")"}Ge(t,e,i){if(t.isCSS3DObject){let s;t.onBeforeRender(this,e,i),t.isCSS3DSprite?(jt.copy(i.matrixWorldInverse),jt.transpose(),0!==t.rotation2D&&jt.multiply(Rt.makeRotationZ(t.rotation2D)),t.matrixWorld.decompose(kt,Tt,Dt),jt.setPosition(kt),jt.scale(Dt),jt.elements[3]=0,jt.elements[7]=0,jt.elements[11]=0,jt.elements[15]=1,s=this.He(jt)):s=this.He(t.matrixWorld);const r=t.element;r.style.transform=s,r.style.display=t.visible?"":"none",r.parentNode!==this.qe&&this.qe.appendChild(r),t.onAfterRender(this,e,i)}}}class Ft{constructor(){this.Xe=[],this.Ye=new Set,this.ur=new Set}cr(){const t=this.Ye;this.Ye=this.ur,this.ur=t}enqueueTransformToUpdate(t){t.isRegisteredToProcessor||(t.isRegisteredToProcessor=!0,this.Xe.push(t))}enqueueRenderObject(t){this.ur.add(t)}dequeueRenderObject(t){this.ur.delete(t)}flush(){this.Ye.clear()}update(){const t=this.Xe;for(let e=0;e<t.length;e++){const i=t[e];i.tryUpdateWorldMatrixRecursivelyFromThisToChildren(),i.isRegisteredToProcessor=!1}return this.Xe.length=0,this.cr(),this.Ye}}class At{constructor(){this.N=new b(M.comparator),this.R=new b(M.comparator),this.q=!1,this.H=[],this.J=[]}addEventToNonSyncedCollection(t){this.N.insert(t)}removeEventFromNonSyncedCollection(t){this.N.delete(t)}addEventToSyncedCollection(t){this.R.insert(t)}startProcessNonSyncedEvent(){this.N.forEach((t=>t.invoke()))}tryStartProcessSyncedEvent(){this.q||(this.q=!0,this.R.forEach((t=>t.invoke())),this.R.clear(),this.q=!1)}addRemoveGameObject(t){this.H.push(t)}addRemoveComponent(t){this.J.push(t)}processRemoveObject(){const t=this.J;for(let e=0;e<t.length;e++)t[e].gameObject.removeComponent(t[e]);const e=this.H;for(let t=0;t<e.length;t++)e[t].removeFromParent()}}class Wt{constructor(){this.tm=1/3,this.im=0,this.h=0,this.sm=0,this.hm=0,this.rm=0,this.am=1}start(){this.im=performance.now()}update(){const t=performance.now();let e=(t-this.im)/1e3;this.tm<e&&(e=this.tm),this.rm=e,this.sm+=e,this.hm=e*this.am,this.h+=this.hm,this.im=t}get time(){return this.h}get unscaledTime(){return this.sm}get deltaTime(){return this.hm}get unscaledDeltaTime(){return this.rm}get timeScale(){return this.am}set timeScale(t){this.am=t}get maximumDeltaTime(){return this.tm}set maximumDeltaTime(t){this.tm=t}}class It{constructor(t,e=!0){this.S=null,this.G=new Mt,this.C=new zt(t.clientWidth,t.clientHeight),this.K=t,this.D=new Pt,this.D.setSize(t.clientWidth,t.clientHeight),this.D.domElement.style.width="100%",this.D.domElement.style.height="100%",this.D.domElement.onscroll=()=>{this.D.domElement.scrollLeft=0,this.D.domElement.scrollTop=0},this.i=new Ot((t=>{this.D.domElement.style.backgroundColor="rgba("+255*t.r+","+255*t.g+","+255*t.b+","+t.a+")"})),this.h=new Wt,this.o=new wt(Ct.WaitingForStart),this.g=new At,this.p=new p(this.h),this.m=new Ft,this.l=new St,this.O=new _t(this.G,this.i,this.h,this.o,this.C,this.g,this.p,this.m,this.l,this.D.domElement),this.T=null,this.F=!1,this.j=e,this.v=this.resizeFramebuffer.bind(this),e&&window.addEventListener("resize",this.v),this.A=this.M.bind(this)}resizeFramebuffer(){const t=this.K.clientWidth,e=this.K.clientHeight;t===this.C.width&&e===this.C.height||(this.C.resize(t,e),this.D.setSize(t,e),this.D.domElement.style.width="100%",this.D.domElement.style.height="100%")}run(t,e){if(this.F)throw new Error("Game is disposed.");if(this.o.kind!==Ct.WaitingForStart)throw new Error("Game is already running.");this.o.kind=Ct.Initializing,this.h.start();const i=new t(this.O,e),s=i.run();if(this.S=i.getGameSettingObject(),this.O.applyGameSetting(this.S),this.S.render.useCss3DRenderer&&this.K.appendChild(this.D.domElement),s.build(),!this.i.camera)throw new Error("Camera is not exist or not active in the scene.");if(this.o.kind=Ct.Running,this.g.startProcessNonSyncedEvent(),this.l.update(this.h.deltaTime),this.p.updateAfterProcess(),!this.i.camera)throw new Error("Camera is not exist or not active in the scene.");this.g.processRemoveObject();const r=this.m.update();this.S.render.useCss3DRenderer&&this.D.render(r,this.G.unsafeGetThreeScene(),this.i.camera.threeCamera),this.m.flush(),this.p.endFrameAfterProcess(),this.T=requestAnimationFrame(this.A)}M(){if(this.h.update(),this.g.startProcessNonSyncedEvent(),this.l.update(this.h.deltaTime),this.p.tryCompact(),this.p.updateAfterProcess(),!this.i.camera)throw new Error("Camera is not exist or not active in the scene.");this.g.processRemoveObject();const t=this.m.update();this.S.render.useCss3DRenderer&&this.D.render(t,this.G.unsafeGetThreeScene(),this.i.camera.threeCamera),this.m.flush(),this.p.endFrameAfterProcess(),this.T=requestAnimationFrame(this.A)}stop(){if(this.F)throw new Error("Game is disposed.");if(this.o.kind!==Ct.Running)throw new Error("Game is not running.");this.o.kind=Ct.Stopped,this.T&&cancelAnimationFrame(this.T),this.T=null}resume(){if(this.F)throw new Error("Game is disposed.");if(this.o.kind!==Ct.Stopped)throw new Error("Game is not stopped.");this.o.kind=Ct.Running,this.M()}dispose(){if(this.F)return;this.o.kind=Ct.Finalizing,this.T&&cancelAnimationFrame(this.T),this.O.dispose();const t=this.G.children;for(let e=0;e<t.length;e++)t[e].gameObject.destroy();this.j&&window.removeEventListener("resize",this.v),this.K.removeChild(this.D.domElement),this.F=!0,this.o.kind=Ct.Finalized}get inputHandler(){return this.O.input}get currentGameState(){return this.o.kind}}class Lt{constructor(t){this.g=t,this.V=[]}withChild(t){return this.V.push(t),this}build(){for(let t=0;t<this.V.length;t++)this.V[t].build(null);vt.processEventByGroup(this.V,this.g)}}class Nt{constructor(t){this.Z=t}static createDefaultObject(){return{}}loader(t){return this.Z.loader=t,this}gravity(t){return this.Z.gravity=t,this}defaultMaterial(t){return this.Z.defaultMaterial=t,this}velocityIterations(t){return this.Z.velocityIterations=t,this}positionIterations(t){return this.Z.positionIterations=t,this}queriesHitTriggers(t){return this.Z.queriesHitTriggers=t,this}reuseCollisionCallbacks(t){return this.Z.reuseCollisionCallbacks=t,this}layerCollisionMatrix(t){return this.Z.collisionLayerMaskMatrix=t,this}}class qt{constructor(t){this.$=t}static createDefaultObject(){return{useCss3DRenderer:!0}}useCss3DRenderer(t){return this.$.useCss3DRenderer=t,this}}class Vt{constructor(t){this.W=t,this.X=new qt(this.W.render),this.Y=new Nt(this.W.physics)}static createDefaultObject(){return{render:qt.createDefaultObject(),physics:Nt.createDefaultObject()}}get render(){return this.X}get physics(){return this.Y}make(){return this.W}}class Bt{constructor(t=null){this.ref=t}}class Ut extends ot{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new F,this.projectionMatrix=new F,this.projectionMatrixInverse=new F}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class Zt extends Ut{constructor(t=50,e=1,i=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*k*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*z*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*k*Math.atan(Math.tan(.5*z*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,s,r,n){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=n,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*z*this.fov)/this.zoom,i=2*e,s=this.aspect*i,r=-.5*s;const n=this.view;if(null!==this.view&&this.view.enabled){const t=n.fullWidth,h=n.fullHeight;r+=n.offsetX*s/t,e-=n.offsetY*i/h,s*=n.width/t,i*=n.height/h}const h=this.filmOffset;0!==h&&(r+=t*h/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}class Gt extends Ut{constructor(t=-1,e=1,i=1,s=-1,r=.1,n=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=s,this.near=r,this.far=n,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,i,s,r,n){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=n,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=i-t,n=i+t,h=s+e,o=s-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=t*this.view.offsetX,n=r+t*this.view.width,h-=e*this.view.offsetY,o=h-e*this.view.height}this.projectionMatrix.makeOrthographic(r,n,h,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}class Xt{constructor(t,e,i){this.ct=t,this.gt=0,this.vt=e,this.xt=null,this.It=!1,this.Tt=i}get component(){return this.ct}get elapsedTime(){return this.gt}set elapsedTime(t){this.gt=t}get currentYieldInstruction(){return this.xt}get currentYieldInstructionExist(){return this.It}fatchNextInstruction(){var t;const e=this.vt.next();return e.done?(this.xt=null,this.It=!1,null===(t=this.Tt)||void 0===t||t.call(this),this.Tt=null,null):(this.xt=e.value,this.It=!0,this.xt)}}class Yt{constructor(){this.awakeCalled=!1,this.startRegistered=!1,this.startCalled=!1,this.updateRegistered=!1,this.enabled=!1}}class Ht{constructor(t){this.Ut=null,this.Rt=null,this.jt=null,this.qt=null,this.zt=null,this.Bt=null,this.Gt=null,this.Ht=null,this.Jt=null,this.Kt=null,this.ct=t,this.g=t.engine.sceneProcessor,this.P=t.engine.instantiater,this.Lt=new Yt,function(t){return void 0!==t.awake}(t)&&(this.Ut=M.createAwakeEvent(this.P,t.awake.bind(t))),function(t){return void 0!==t.onDestroy}(t)&&(this.Rt=M.createOnDestroyEvent(this.P,t.onDestroy.bind(t),t.executionOrder)),function(t){return void 0!==t.onCollisionEnter2D}(t)&&(this.jt=M.createOnCollisionEnter2DEvent(this.P,(e=>t.onCollisionEnter2D(e)),t.executionOrder)),function(t){return void 0!==t.onCollisionStay2D}(t)&&(this.qt=M.createOnCollisionStay2DEvent(this.P,(e=>t.onCollisionStay2D(e)),t.executionOrder)),function(t){return void 0!==t.onCollisionExit2D}(t)&&(this.zt=M.createOnCollisionExit2DEvent(this.P,(e=>t.onCollisionExit2D(e)),t.executionOrder)),function(t){return void 0!==t.onTriggerEnter2D}(t)&&(this.Bt=M.createOnTriggerEnter2DEvent(this.P,(e=>t.onTriggerEnter2D(e)),t.executionOrder)),function(t){return void 0!==t.onTriggerStay2D}(t)&&(this.Gt=M.createOnTriggerStay2DEvent(this.P,(e=>t.onTriggerStay2D(e)),t.executionOrder)),function(t){return void 0!==t.onTriggerExit2D}(t)&&(this.Ht=M.createOnTriggerExit2DEvent(this.P,(e=>t.onTriggerExit2D(e)),t.executionOrder)),function(t){return void 0!==t.start}(t)&&(this.Jt=M.createStartEvent(this.P,(()=>{this.Lt.startCalled=!0,t.start(),this.Lt.startRegistered&&this.g.removeEventFromNonSyncedCollection(this.Jt)}),t.executionOrder)),function(t){return void 0!==t.update}(t)&&(this.Kt=M.createUpdateEvent(this.P,t.update.bind(t),t.executionOrder))}tryCallAwake(){var t;this.Lt.awakeCalled||(this.Lt.awakeCalled=!0,null===(t=this.Ut)||void 0===t||t.invoke())}tryRegisterOnEnable(){if(!function(t){return void 0!==t.onEnable}(this.ct))return;if(this.ct._engine_internal_destroyed)return;if(this.Lt.enabled)return;this.Lt.enabled=!0;const t=M.createOnEnableEvent(this.P,this.ct.onEnable.bind(this.ct),this.ct.executionOrder);this.g.addEventToSyncedCollection(t)}tryRegisterOnDisable(){if(!function(t){return void 0!==t.onDisable}(this.ct))return;if(this.ct._engine_internal_destroyed)return;if(!this.Lt.enabled)return;this.Lt.enabled=!1;const t=M.createOnDisableEvent(this.P,this.ct.onDisable.bind(this.ct),this.ct.executionOrder);this.g.addEventToSyncedCollection(t)}tryRegisterOnDestroy(){this.Rt&&this.g.addEventToSyncedCollection(this.Rt)}tryRegisterStart(){this.Jt&&(this.ct._engine_internal_destroyed||this.Lt.startCalled||this.Lt.startRegistered||(this.Lt.startRegistered=!0,this.g.addEventToNonSyncedCollection(this.Jt)))}tryUnregisterStart(){this.Jt&&this.Lt.startRegistered&&!this.Lt.startCalled&&(this.Lt.startRegistered=!1,this.g.removeEventFromNonSyncedCollection(this.Jt))}tryRegisterUpdate(){this.Kt&&(this.ct._engine_internal_destroyed||this.Lt.updateRegistered||(this.Lt.updateRegistered=!0,this.g.addEventToNonSyncedCollection(this.Kt)))}tryUnregisterUpdate(){this.Kt&&this.Lt.updateRegistered&&(this.Lt.updateRegistered=!1,this.g.removeEventFromNonSyncedCollection(this.Kt))}get onCollisionEnter2D(){return this.jt}get onCollisionStay2D(){return this.qt}get onCollisionExit2D(){return this.zt}get onTriggerEnter2D(){return this.Bt}get onTriggerStay2D(){return this.Gt}get onTriggerExit2D(){return this.Ht}}class Qt{constructor(t){this.disallowMultipleComponent=!1,this.requiredComponents=[],this.executionOrder=0,this._runningCoroutines=[],this._engine_internal_destroyed=!1,this._enabled=!0,this._gameObject=t,this._instanceId=t.engine.instantiater.generateId(),this._engine_internal_componentEventContainer=null}engine_internal_constructAfterProcess(){this._engine_internal_componentEventContainer=new Ht(this),Object.defineProperties(this,{disallowMultipleComponent:{configurable:!1,writable:!1},requiredComponents:{configurable:!1,writable:!1},executionOrder:{configurable:!1,writable:!1}})}startCoroutine(t){this.checkComponentIsExist();const e=new Xt(this,t,(()=>{const t=this._runningCoroutines.indexOf(e);t>=0&&this._runningCoroutines.splice(t,1)}));return this._runningCoroutines.push(e),e.fatchNextInstruction(),this.engine.coroutineProcessor.addCoroutine(e),e}stopAllCoroutines(){this.checkComponentIsExist(),this._runningCoroutines.forEach((t=>{this.stopCoroutine(t)})),this._runningCoroutines.length=0}stopCoroutine(t){if(this.checkComponentIsExist(),t.component!==this)throw new Error("Coroutine is not owned by this component");this.engine.coroutineProcessor.removeCoroutine(t);const e=this._runningCoroutines.indexOf(t);e>=0&&this._runningCoroutines.splice(e,1)}get enabled(){return this._enabled}set enabled(t){this.checkComponentIsExist(),this._enabled!==t&&(this._enabled=t,this._gameObject.initialized&&this._gameObject.activeInHierarchy&&(this._enabled?(this._engine_internal_componentEventContainer.tryRegisterOnEnable(),this._engine_internal_componentEventContainer.tryRegisterStart(),this._engine_internal_componentEventContainer.tryRegisterUpdate(),this.engine.sceneProcessor.tryStartProcessSyncedEvent()):(this._engine_internal_componentEventContainer.tryRegisterOnDisable(),this._engine_internal_componentEventContainer.tryUnregisterStart(),this._engine_internal_componentEventContainer.tryUnregisterUpdate(),this.engine.sceneProcessor.tryStartProcessSyncedEvent())))}checkComponentIsExist(){if(this._engine_internal_destroyed)throw new Error("Component "+this.constructor.name+" is destroyed")}get gameObject(){return this._gameObject}get transform(){return this._gameObject.transform}get engine(){return this._gameObject.engine}get instanceId(){return this._instanceId}get initialized(){return this._gameObject.initialized}get exists(){return!this._engine_internal_destroyed}destroy(){this._engine_internal_destroyed||(this.enabled&&this.gameObject.activeInHierarchy&&(this._engine_internal_componentEventContainer.tryRegisterOnDisable(),this._engine_internal_componentEventContainer.tryUnregisterStart(),this._engine_internal_componentEventContainer.tryUnregisterUpdate()),this.stopAllCoroutines(),this._engine_internal_componentEventContainer.tryRegisterOnDestroy(),this._engine_internal_destroyed=!0,this.engine.sceneProcessor.tryStartProcessSyncedEvent(),this.engine.sceneProcessor.addRemoveComponent(this))}}class $t{constructor(t=0,e=0,i=0,s=1){1<t?t=1:0>t&&(t=0),1<e?e=1:0>e&&(e=0),1<i?i=1:0>i&&(i=0),1<s?s=1:0>s&&(s=0),this.Ue=t,this.$e=e,this.Je=i,this.Le=s}set(t,e,i,s=1){return 1<t?t=1:0>t&&(t=0),1<e?e=1:0>e&&(e=0),1<i?i=1:0>i&&(i=0),1<s?s=1:0>s&&(s=0),this.Ue=t,this.$e=e,this.Je=i,this.Le=s,this}copy(t){return this.Ue=t.r,this.$e=t.g,this.Je=t.b,this.Le=t.a,this}clone(){return new $t(this.Ue,this.$e,this.Je,this.Le)}get r(){return this.Ue}set r(t){1<t?t=1:0>t&&(t=0),this.Ue=t}get g(){return this.$e}set g(t){1<t?t=1:0>t&&(t=0),this.$e=t}get b(){return this.Je}set b(t){1<t?t=1:0>t&&(t=0),this.Je=t}get a(){return this.Le}set a(t){1<t?t=1:0>t&&(t=0),this.Le=t}toString(){return"rgb("+255*this.Ue+", "+255*this.$e+", "+255*this.Je+")"}toStringWithAlpha(){return"rgba("+255*this.Ue+", "+255*this.$e+", "+255*this.Je+", "+this.Le+")"}toHex(){return"#"+((Math.round(255*this.Ue)<<16)+(Math.round(255*this.$e)<<8)+(Math.round(255*this.Je)<<0)).toString(16).padStart(6,"0")}toHexWithAlpha(){return"#"+((Math.round(255*this.Ue)<<16)+(Math.round(255*this.$e)<<8)+(Math.round(255*this.Je)<<0)).toString(16).padStart(6,"0")+Math.round(255*this.Le).toString(16).padStart(2,"0")}toArray(){return[this.Ue,this.$e,this.Je,this.Le]}static fromHex(t){const e=parseInt(t.slice(1,3),16)/255,i=parseInt(t.slice(3,5),16)/255,s=parseInt(t.slice(5,7),16)/255;return new $t(e,i,s)}static fromArray(t){return new $t(t[0],t[1],t[2],t[3])}static fromString(t){const e=t.match(/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d*(?:\.\d+)?)\)$/);return e?new $t(parseInt(e[1]),parseInt(e[2]),parseInt(e[3]),parseFloat(e[4])):$t.fromHex(t)}hueRotate(t=0,e){t=t/180*Math.PI;const i=Math.sin(t),s=Math.cos(t);this.multiplyMatrix((null!=e?e:new X).set(.213+.787*s-.213*i,.715-.715*s-.715*i,.072-.072*s+.928*i,.213-.213*s+.143*i,.715+.285*s+.14*i,.072-.072*s-.283*i,.213-.213*s-.787*i,.715-.715*s+.715*i,.072+.928*s+.072*i))}grayscale(t=1,e){this.multiplyMatrix((null!=e?e:new X).set(.2126+.7874*(1-t),.7152-.7152*(1-t),.0722-.0722*(1-t),.2126-.2126*(1-t),.7152+.2848*(1-t),.0722-.0722*(1-t),.2126-.2126*(1-t),.7152-.7152*(1-t),.0722+.9278*(1-t)))}sepia(t=1,e){this.multiplyMatrix((null!=e?e:new X).set(.393+.607*(1-t),.769-.769*(1-t),.189-.189*(1-t),.349-.349*(1-t),.686+.314*(1-t),.168-.168*(1-t),.272-.272*(1-t),.534-.534*(1-t),.131+.869*(1-t)))}saturate(t=1,e){this.multiplyMatrix((null!=e?e:new X).set(.213+.787*t,.715-.715*t,.072-.072*t,.213-.213*t,.715+.285*t,.072-.072*t,.213-.213*t,.715-.715*t,.072+.928*t))}brightness(t=1){this.linear(t)}contrast(t=1){this.linear(t,-.5*t+.5)}invert(t=1){let e=t+this.Ue*(1-2*t),i=t+this.$e*(1-2*t),s=t+this.Je*(1-2*t);1<e?e=1:e<0&&(e=0),1<i?i=1:i<0&&(i=0),1<s?s=1:s<0&&(s=0),this.Ue=e,this.$e=i,this.Je=s}multiplyMatrix(t){const e=t.elements;let i=this.Ue*e[0]+this.$e*e[1]+this.Je*e[2],s=this.Ue*e[3]+this.$e*e[4]+this.Je*e[5],r=this.Ue*e[6]+this.$e*e[7]+this.Je*e[8];return 1<i?i=1:i<0&&(i=0),1<s?s=1:s<0&&(s=0),1<r?r=1:r<0&&(r=0),this.Ue=i,this.$e=s,this.Je=r,this}linear(t=1,e=0){let i=this.Ue*t+e,s=this.$e*t+e,r=this.Je*t+e;return 1<i?i=1:i<0&&(i=0),1<s?s=1:s<0&&(s=0),1<r?r=1:r<0&&(r=0),this.Ue=i,this.$e=s,this.Je=r,this}hsl(){const t=this.Ue,e=this.$e,i=this.Je,s=Math.max(t,e,i),r=Math.min(t,e,i);let n,h;const o=(s+r)/2;if(s===r)n=h=0;else{const a=s-r;switch(h=o>.5?a/(2-s-r):a/(s+r),s){case t:n=(e-i)/a+(e<i?6:0);break;case e:n=(i-t)/a+2;break;case i:n=(t-e)/a+4;break;default:throw new Error("Unreachable")}n/=6}return{h:n,s:h,l:o}}}class Jt{constructor(t,e){this.Dt=t,this.nr=(new $t).copy(e)}get priority(){return this.Dt}set priority(t){this.Dt=t}get backgroundColor(){return this.nr}set backgroundColor(t){this.nr.copy(t)}}var Kt;!function(t){t[t.Perspective=0]="Perspective",t[t.Orthographic=1]="Orthographic"}(Kt||(Kt={}));class te extends Qt{constructor(){super(...arguments),this.mh=null,this.Ca=Kt.Orthographic,this.Ta=75,this.va=5,this.ya=.1,this.da=1e3,this.Dt=0,this.wa=new $t(1,1,1,0),this.Pa=(t,e)=>{const i=t/e;if(this.mh instanceof Zt)this.mh.aspect=i,this.mh.updateProjectionMatrix();else if(this.mh instanceof Gt){const t=this.va;this.mh.left=-t*i,this.mh.right=t*i,this.mh.top=t,this.mh.bottom=-t,this.mh.updateProjectionMatrix()}}}onEnable(){this.engine.screen.onResize.addListener(this.Pa),this.Oa()}onWorldMatrixUpdated(){this.mh&&(yt.updateRawObject3DWorldMatrixRecursively(this.mh),this.mh.matrixWorldInverse.copy(this.mh.matrixWorld).invert())}Oa(){const t=this.engine.screen.width/this.engine.screen.height;if(this.Ca===Kt.Perspective)this.mh?this.mh instanceof Zt?(this.mh.aspect=t,this.mh.fov=this.Ta,this.mh.near=this.ya,this.mh.far=this.da,this.mh.updateProjectionMatrix()):(this.mh.removeFromParent(),this.mh=this._a(),this.transform.unsafeGetObject3D().add(this.mh)):(this.mh=this._a(),this.transform.unsafeGetObject3D().add(this.mh));else{if(this.Ca!==Kt.Orthographic)throw new Error("Camera type not supported");if(this.mh)if(this.mh instanceof Gt){const e=this.va;this.mh.left=-e*t,this.mh.right=e*t,this.mh.top=e,this.mh.bottom=-e,this.mh.near=this.ya,this.mh.far=this.da,this.mh.updateProjectionMatrix()}else this.mh.removeFromParent(),this.mh=this.ba(),this.transform.unsafeGetObject3D().add(this.mh);else this.mh=this.ba(),this.transform.unsafeGetObject3D().add(this.mh)}yt.updateRawObject3DWorldMatrixRecursively(this.mh),this.engine.cameraContainer.addCamera(this,new Jt(this.Dt,this.wa))}_a(){const t=this.engine.screen.width/this.engine.screen.height;return new Zt(this.Ta,t,this.ya,this.da)}ba(){const t=this.engine.screen.width/this.engine.screen.height,e=this.va;return new Gt(-e*t,e*t,e,-e,this.ya,this.da)}onDisable(){this.engine.screen.onResize.removeListener(this.Pa),this.mh&&this.engine.cameraContainer.removeCamera(this)}onDestroy(){var t;null===(t=this.mh)||void 0===t||t.removeFromParent()}get cameraType(){return this.Ca}set cameraType(t){this.Ca!==t&&(this.Ca=t,this.mh&&this.Oa())}get fov(){return this.Ta}set fov(t){this.Ta!==t&&(this.Ta=t,this.mh instanceof Zt&&(this.mh.fov=t,this.mh.updateProjectionMatrix()))}get viewSize(){return this.va}set viewSize(t){if(this.va!==t&&(this.va=t,this.mh instanceof Gt)){const t=this.engine.screen.width/this.engine.screen.height,e=this.va;this.mh.left=-e*t,this.mh.right=e*t,this.mh.top=e,this.mh.bottom=-e,this.mh.updateProjectionMatrix()}}get near(){return this.ya}set near(t){this.ya!==t&&(this.ya=t,this.mh instanceof Zt&&(this.mh.near=t,this.mh.updateProjectionMatrix()))}get far(){return this.da}set far(t){this.da!==t&&(this.da=t,this.mh instanceof Zt&&(this.mh.far=t,this.mh.updateProjectionMatrix()))}get priority(){return this.Dt}set priority(t){this.Dt=t,this.mh&&this.engine.cameraContainer.changeCameraPriority(this,t)}get backgroundColor(){return this.wa}set backgroundColor(t){this.wa.copy(t),this.mh&&this.engine.cameraContainer.changeCameraBackgroundColor(this,t)}get threeCamera(){return this.mh}}class ee extends Qt{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.requiredComponents=[te],this._camera=null,this._mouseMoveButtonDown=!1,this._mouseMoveButton=0,this._lastOffset=new Et,this._minViewSize=.01,this._maxViewSize=1e3,this._defaultViewSize=3,this._currentViewSize=3,this._defaultPosition=new j,this._onZoomEvent=new g,this.onKeyDown=t=>{"Escape"===t.key&&(this._currentViewSize=this._defaultViewSize,this.resize(),this.transform.localPosition.copy(this._defaultPosition),this._onZoomEvent.invoke(this._currentViewSize))},this.onWheel=t=>{this._currentViewSize*=Math.pow(1.01,.1*t.deltaY),this._currentViewSize<this._minViewSize?this._currentViewSize=this._minViewSize:this._currentViewSize>this._maxViewSize&&(this._currentViewSize=this._maxViewSize),this.resize(),this._onZoomEvent.invoke(this._currentViewSize)},this.onPointerDown=t=>{this._lastOffset.set(t.clientX/this.engine.screen.width,t.clientY/this.engine.screen.height),t.button===this._mouseMoveButton&&(this._mouseMoveButtonDown=!0)},this.onPointerUp=t=>{t.button===this._mouseMoveButton&&(this._mouseMoveButtonDown=!1)},this.onPointerMove=t=>{if(!this._mouseMoveButtonDown)return;const e=t.clientX/this.engine.screen.width,i=t.clientY/this.engine.screen.height,s=e-this._lastOffset.x,r=i-this._lastOffset.y,n=this.engine.screen.width/this.engine.screen.height;this.transform.localPosition.x-=s*this._camera.viewSize*2*n,this.transform.localPosition.y+=r*this._camera.viewSize*2,this._lastOffset.set(e,i)},this.onPointerLeave=t=>{this._mouseMoveButtonDown=!1}}get onZoom(){return this._onZoomEvent}get viewSize(){return this._currentViewSize}awake(){this._camera=this.gameObject.getComponent(te),this._defaultViewSize=this._camera.viewSize,this._defaultPosition.copy(this.transform.localPosition),this._currentViewSize=this._defaultViewSize,this._camera.viewSize=this._currentViewSize,this._onZoomEvent.invoke(this._currentViewSize)}onEnable(){const t=this.engine.input;t.onKeyDown.addListener(this.onKeyDown),t.onWheel.addListener(this.onWheel),t.onPointerDown.addListener(this.onPointerDown),t.onPointerUp.addListener(this.onPointerUp),t.onPointerMove.addListener(this.onPointerMove),t.onPointerLeave.addListener(this.onPointerLeave)}onDisable(){const t=this.engine.input;t.onKeyDown.removeListener(this.onKeyDown),t.onWheel.removeListener(this.onWheel),t.onPointerDown.removeListener(this.onPointerDown),t.onPointerUp.removeListener(this.onPointerUp),t.onPointerMove.removeListener(this.onPointerMove),t.onPointerLeave.removeListener(this.onPointerLeave)}resize(){this._camera&&(this._camera.viewSize=this._currentViewSize)}get minViewSize(){return this._minViewSize}set minViewSize(t){this._minViewSize=t,this._currentViewSize<this._minViewSize&&(this._currentViewSize=this._minViewSize,this.resize())}get maxViewSize(){return this._maxViewSize}set maxViewSize(t){this._maxViewSize=t,this._currentViewSize>this._maxViewSize&&(this._currentViewSize=this._maxViewSize,this.resize())}get mouseMoveButton(){return this._mouseMoveButton}set mouseMoveButton(t){this._mouseMoveButton=t}}class ie extends Qt{constructor(){super(...arguments),this._cameraController=null,this._cameraRelativeScale=1,this.onZoom=()=>{},this.onZoomInternal=()=>{this.onZoom(this._cameraController.viewSize*this._cameraRelativeScale)}}get cameraController(){return this._cameraController}set cameraController(t){this._cameraController&&this._cameraController.onZoom.removeListener(this.onZoomInternal),this._cameraController=t,t&&(t.onZoom.addListener(this.onZoomInternal),this.onZoomInternal(t.viewSize))}get cameraRelativeScale(){return this._cameraRelativeScale}set cameraRelativeScale(t){this._cameraRelativeScale=t,this._cameraController&&this.onZoomInternal(this._cameraController.viewSize)}onDestroy(){this._cameraController&&this._cameraController.onZoom.removeListener(this.onZoomInternal),this._cameraController=null}}class se extends ot{constructor(t=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=t,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable","false"),this.addEventListener("removed",(()=>{this.traverse((t=>{t instanceof se&&t.element instanceof Element&&null!==t.element.parentNode&&t.element.parentNode.removeChild(t.element)}))}))}copy(t,e){return super.copy(t,e),this.element=t.element.cloneNode(!0),this}}new j,new D,new j,new F,new F;class re extends Qt{}class ne extends re{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.Za=!0}start(){this.Ja(),this.runOnce&&(this.enabled=!1)}update(){this.Ja()}Ja(){this.gameObject.getComponentsInChildren().forEach((t=>{const e=t;e.onSortByZaxis&&"function"==typeof e.onSortByZaxis&&e.onSortByZaxis(t.transform.position.z)}))}static checkAncestorZaxisInitializer(t,e){if(!t.transform.parent)return;let i=t.transform.parent;for(;i;){if(i.gameObject.getComponent(ne))return void e(i.position.z);if(null===i.parent)break;i=i.parent}}get runOnce(){return this.Za}set runOnce(t){this.Za=t}}class he extends Qt{constructor(){super(...arguments),this.css3DObject=null,this.htmlElement=null,this.ua=new Et,this.Sa=.1,this.qr=!0,this.Tn=0,this.Ea=!1}start(){this.Ea=!0,this.renderInitialize(),ne.checkAncestorZaxisInitializer(this.gameObject,this.onSortByZaxis.bind(this))}onDestroy(){this.css3DObject&&(this.transform.dequeueRenderAttachedObject3D(this.css3DObject),this.transform.unsafeGetObject3D().remove(this.css3DObject),this.css3DObject=null,this.htmlElement=null)}onEnable(){this.css3DObject&&(this.css3DObject.visible=!0,this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}onDisable(){this.css3DObject&&(this.css3DObject.visible=!1,this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}onSortByZaxis(t){this.Tn=t/.1,this.css3DObject&&(this.css3DObject.element.style.zIndex=Math.floor(this.Tn).toString())}onWorldMatrixUpdated(){this.css3DObject&&(yt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}renderInitialize(){throw new Error("Yon can't Use CssRenderer Directly, use Derived Class e.g. CssSpriteRenderer")}initializeBaseComponents(t){if(!this.htmlElement)throw new Error("htmlElement is null");let e=!1;return t?(this.css3DObject&&this.transform.unsafeGetObject3D().remove(this.css3DObject),this.css3DObject=new se(this.htmlElement),e=!0):this.css3DObject?this.css3DObject.element=this.htmlElement:(this.css3DObject=new se(this.htmlElement),e=!0),e&&(this.htmlElement.style.pointerEvents=this.pointerEvents?"auto":"none",this.htmlElement.style.zIndex=Math.floor(this.Tn).toString(),this.enabled&&this.gameObject.activeInHierarchy?this.css3DObject.visible=!0:this.css3DObject.visible=!1),this.updateViewScale(!1),this.updateCenterOffset(!1),this.transform.unsafeGetObject3D().add(this.css3DObject),this.css3DObject}updateCenterOffset(t){throw new Error("Yon can't Use CssRenderer Directly, use Derived Class e.g. CssSpriteRenderer")}updateViewScale(t){throw new Error("Yon can't Use CssRenderer Directly, use Derived Class e.g. CssSpriteRenderer")}get centerOffset(){return this.ua}set centerOffset(t){this.ua.copy(t),this.updateCenterOffset(!0)}get viewScale(){return this.Sa}set viewScale(t){this.Sa=t,this.updateViewScale(!0)}get pointerEvents(){return this.qr}set pointerEvents(t){this.qr=t,this.htmlElement&&(this.htmlElement.style.pointerEvents=t?"auto":"none")}get readyToDraw(){return this.Ea}}class oe extends he{constructor(){super(...arguments),this.tu=1,this.su=1,this.iu=!1,this.ma=null}renderInitialize(){var t;null===(t=this.ma)||void 0===t||t.call(this),this.htmlElement||(this.element=null)}updateCenterOffset(t){if(!this.css3DObject)return;let e,i;if(this.iu)if(this.css3DObject.element.parentElement){const t=this.css3DObject.element.style.display;this.css3DObject.element.style.display="",e=this.css3DObject.element.offsetWidth*this.viewScale,i=this.css3DObject.element.offsetHeight*this.viewScale,this.css3DObject.element.style.display=t}else{const t=this.css3DObject.element.style.display;this.css3DObject.element.style.display="";const s=this.css3DObject.element.style.transform;this.css3DObject.element.style.transform="translateX(1000000px)",document.body.appendChild(this.css3DObject.element),e=this.css3DObject.element.offsetWidth*this.viewScale,i=this.css3DObject.element.offsetHeight*this.viewScale,this.css3DObject.element.style.display=t,this.css3DObject.element.style.transform=s,document.body.removeChild(this.css3DObject.element)}else e=this.tu,i=this.su;this.css3DObject.position.set(e*this.centerOffset.x,i*this.centerOffset.y,0),t&&(yt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}updateViewScale(t){if(!this.css3DObject)return;const e=this.viewScale;this.iu?(this.css3DObject.scale.set(e,e,e),this.updateCenterOffset(!1)):(this.css3DObject.element.style.width=this.tu/this.viewScale+"px",this.css3DObject.element.style.height=this.su/this.viewScale+"px",this.css3DObject.scale.set(e,e,e)),t&&(yt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}get element(){return this.htmlElement}set element(t){const e=this.htmlElement=null!=t?t:document.createElement("div");this.readyToDraw?this.hu(e):this.ma=()=>this.hu(e)}hu(t){this.iu?(t.style.width="auto",t.style.height="auto"):(t.style.width=this.tu/this.viewScale+"px",t.style.height=this.su/this.viewScale+"px");const e=this.initializeBaseComponents(!0);yt.updateRawObject3DWorldMatrixRecursively(e),this.transform.enqueueRenderAttachedObject3D(e)}get elementWidth(){if(this.iu){if(this.htmlElement){const t=this.htmlElement.style.display;this.htmlElement.style.display="";const e=this.htmlElement.offsetWidth*this.viewScale;return this.htmlElement.style.display=t,e}return 0}return this.tu}set elementWidth(t){this.iu||(this.tu=t,this.htmlElement&&(this.htmlElement.style.width=t/this.viewScale+"px"),this.updateCenterOffset(!0))}get elementHeight(){if(this.iu){if(this.htmlElement){const t=this.htmlElement.style.display;this.htmlElement.style.display="";const e=this.htmlElement.offsetHeight*this.viewScale;return this.htmlElement.style.display=t,e}return 0}return this.su}set elementHeight(t){this.iu||(this.su=t,this.htmlElement&&(this.htmlElement.style.height=t/this.viewScale+"px"),this.updateCenterOffset(!0))}get autoSize(){return this.iu}set autoSize(t){this.iu=t,this.htmlElement&&(t?(this.htmlElement.style.width="auto",this.htmlElement.style.height="auto"):(this.htmlElement.style.width=this.tu/this.viewScale+"px",this.htmlElement.style.height=this.su/this.viewScale+"px"))}}var ae=function(t){this.value=void 0,this.pre=void 0,this.next=void 0,this.value=t},le=function(t,e,i,s){void 0===s&&(s="normal"),Object.defineProperties(this,{iteratorType:{value:s},node:{value:t},pointer:{get:function(){return t.value},set:function(e){if(void 0===t.value)throw new Error("LinkList iterator access denied!");if(null==e)throw new Error("you can't push undefined or null here");t.value=e},enumerable:!0}}),this.equals=function(t){if(t.constructor.name!==this.constructor.name)throw new Error("obj's constructor is not ".concat(this.constructor.name,"!"));if(this.iteratorType!==t.iteratorType)throw new Error("iterator type error!");return this.node===t.node},this.pre=function(){if("reverse"===this.iteratorType){if(t===i)throw new Error("LinkList iterator access denied!");return new le(t.next||t,e,i,this.iteratorType)}if(t===e)throw new Error("LinkList iterator access denied!");return new le(t.pre||t,e,i)},this.next=function(){if("reverse"===this.iteratorType){if(void 0===t.value)throw new Error("LinkList iterator access denied!");return new le(t.pre||t,e,i,this.iteratorType)}if(void 0===t.value)throw new Error("LinkList iterator access denied!");return new le(t.next||t,e,i)}};const ce=function(t){var e=this;void 0===t&&(t=[]);var i=0,s=void 0,r=void 0,n=new ae;this.size=function(){return i},this.empty=function(){return 0===i},this.clear=function(){i=0,s=r=void 0,n.pre=n.next=void 0},this.begin=function(){return new le(s||n,s||n,r||n)},this.end=function(){return new le(n,s||n,r||n)},this.rBegin=function(){return new le(r||n,s||n,r||n)},this.rEnd=function(){return new le(n,s||n,r||n)},this.front=function(){return null==s?void 0:s.value},this.back=function(){return null==r?void 0:r.value},this.forEach=function(t){for(var e=s,i=0;e&&e!==n;){if(void 0===e.value)throw new Error("unknown error");t(e.value,i++),e=e.next}},this.getElementByPos=function(t){if(t<0||t>=i)throw new Error("pos must more then 0 and less then the list length");for(var e=s;t--&&e;)e=e.next;if(!e||void 0===e.value)throw new Error("unknown error");return e.value},this.eraseElementByPos=function(t){if(t<0||t>=i)throw new Error("erase pos must more then 0 and less then the list length");if(0===t)this.popFront();else if(t===i-1)this.popBack();else{for(var e=s;t--;){if(!(null==e?void 0:e.next))throw new Error("unknown error");e=e.next}if(!e||!e.pre||!e.next)throw new Error("unknown error");var r=e.pre,n=e.next;n.pre=r,r.next=n,i>0&&--i}},this.eraseElementByValue=function(t){for(;s&&s.value===t;)this.popFront();for(;r&&r.value===t;)this.popBack();if(s)for(var e=s;e&&e!==n;){if(e.value===t){var h=e.pre,o=e.next;o&&(o.pre=h),h&&(h.next=o),i>0&&--i}e=e.next}},this.pushBack=function(t){if(null==t)throw new Error("you can't push null or undefined here");++i;var e=new ae(t);r?(r.next=e,e.pre=r,r=e):(s=r=e,n.next=s,s.pre=n),r.next=n,n.pre=r},this.popBack=function(){r&&(i>0&&--i,s===r?(s=r=void 0,n.next=void 0):(r=r.pre)&&(r.next=void 0),n.pre=r,r&&(r.next=n))},this.setElementByPos=function(t,e){if(null==e)throw new Error("you can't set null or undefined here");if(t<0||t>=i)throw new Error("pos must more then 0 and less then the list length");for(var r=s;t--;){if(!r)throw new Error("unknown error");r=r.next}r&&(r.value=e)},this.insert=function(t,e,r){if(void 0===r&&(r=1),null==e)throw new Error("you can't insert null or undefined here");if(t<0||t>i)throw new Error("insert pos must more then 0 and less then or equal to the list length");if(r<0)throw new Error("insert size must more than 0");if(0===t)for(;r--;)this.pushFront(e);else if(t===i)for(;r--;)this.pushBack(e);else{for(var n=s,h=1;h<t;++h){if(!(null==n?void 0:n.next))throw new Error("unknown error");n=null==n?void 0:n.next}if(!n)throw new Error("unknown error");var o=n.next;for(i+=r;r--;)n.next=new ae(e),n.next.pre=n,n=n.next;n.next=o,o&&(o.pre=n)}},this.find=function(t){for(var e=s;e&&e!==n;){if(e.value===t)return new le(e,s||n,r||n);e=e.next}return this.end()},this.reverse=function(){for(var t=s,e=r,n=0;t&&e&&2*n<i;){var h=t.value;t.value=e.value,e.value=h,t=t.next,e=e.pre,++n}},this.unique=function(){for(var t=s;t&&t!==n;){for(var e=t;e&&e.next&&e.value===e.next.value;)e=e.next,i>0&&--i;t.next=e.next,t.next&&(t.next.pre=t),t=t.next}},this.sort=function(t){var e=[];this.forEach((function(t){e.push(t)})),e.sort(t);var i=s;e.forEach((function(t){i&&(i.value=t,i=i.next)}))},this.pushFront=function(t){if(null==t)throw new Error("you can't push null or undefined here");++i;var e=new ae(t);s?(e.next=s,s.pre=e,s=e):(s=r=e,r.next=n,n.pre=r),n.next=s,s.pre=n},this.popFront=function(){s&&(i>0&&--i,s===r?(s=r=void 0,n.pre=r):(s=s.next)&&(s.pre=n),n.next=s)},this.merge=function(t){var e=this,h=s;t.forEach((function(t){for(;h&&h!==n&&void 0!==h.value&&h.value<=t;)h=h.next;if(h===n)e.pushBack(t),h=r;else if(h===s)e.pushFront(t),h=s;else{if(!h)throw new Error("unknown error");++i;var o=h.pre;o&&(o.next=new ae(t),o.next.pre=o,o.next.next=h,h&&(h.pre=o.next))}}))},"symbol"==typeof Symbol.iterator&&(this[Symbol.iterator]=function(){return function(){var t;return function(t,e){var i,s,r,n,h={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function o(n){return function(o){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;h;)try{if(i=1,s&&(r=2&n[0]?s.return:n[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,n[1])).done)return r;switch(s=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return h.label++,{value:n[1],done:!1};case 5:h.label++,s=n[1],n=[0];continue;case 7:n=h.ops.pop(),h.trys.pop();continue;default:if(!((r=(r=h.trys).length>0&&r[r.length-1])||6!==n[0]&&2!==n[0])){h=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){h.label=n[1];break}if(6===n[0]&&h.label<r[1]){h.label=r[1],r=n;break}if(r&&h.label<r[2]){h.label=r[2],h.ops.push(n);break}r[2]&&h.ops.pop(),h.trys.pop();continue}n=e.call(t,h)}catch(t){n=[6,t],s=0}finally{i=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,o])}}}(this,(function(e){switch(e.label){case 0:t=s,e.label=1;case 1:if(!t||t===n)return[3,3];if(!t.value)throw new Error("unknown error");return[4,t.value];case 2:return e.sent(),t=t.next,[3,1];case 3:return[2]}}))}()}),t.forEach((function(t){return e.pushBack(t)}))},ue=function(t){void 0===t&&(t=[]);var e=new ce(t);this.size=function(){return e.size()},this.empty=function(){return e.empty()},this.clear=function(){e.clear()},this.push=function(t){e.pushBack(t)},this.pop=function(){e.popFront()},this.front=function(){return e.front()}};class de{static computeLod(t){return t*=de._viewOffset,Math.max(Math.pow(10,Math.floor(Math.log10(t))),.5*Math.pow(10,Math.floor(Math.log10(t/.5))),.2*Math.pow(10,Math.floor(Math.log10(t/.2))))}}de._viewOffset=.4;class me extends Qt{constructor(){super(...arguments),this._equation=t=>NaN,this._viewScale=.01,this._cameraRelativeChunkSize=2,this._chunkResolution=512,this._chunkSize=NaN,this._chunkObjectPool=[],this._activeChunks=new Map,this._sampleCount=320,this._program=null,this._lastCameraPosition=new Et(NaN,NaN),this._lastCameraViewSize=NaN,this._lastChunkStep=NaN,this._tempVector3=new j}get equation(){return this._equation}set equation(t){this._equation=t;const e=this.engine.cameraContainer.camera;e&&(this.clearChunks(),this.startCoroutine(this.renderChunk(e)))}get viewScale(){return this._viewScale}set viewScale(t){this._viewScale=t;for(const e of this._activeChunks.values())e.viewScale=t}getChunkObject(){let t=this._chunkObjectPool.pop();if(!t){const e=new Bt;this.engine.scene.addChildFromBuilder(this.engine.instantiater.buildGameObject("chunk-object").active(!1).withComponent(oe,(t=>{const e=document.createElement("canvas");e.style.width="100%",e.style.height="100%",e.style.position="absolute",e.style.top="0",e.style.left="0",e.width=this._chunkResolution,e.height=this._chunkResolution,t.element=e})).getComponent(oe,e)),t=e.ref}return t.gameObject.activeSelf=!0,t}releaseChunkObject(t){t.gameObject.activeSelf=!1,this._chunkObjectPool.push(t)}*renderChunk(t){let e=performance.now();for(const e of this._activeChunks.keys()){const i=parseInt(e.split("_")[0]),s=parseInt(e.split("_")[1]);this.is2DFrustumCulled(t,i,s)&&(this.releaseChunkObject(this._activeChunks.get(e)),this._activeChunks.delete(e))}100<performance.now()-e&&(e=performance.now(),yield null);const i=t.transform.position,s=Math.floor(i.x/this._chunkSize),r=Math.floor(i.y/this._chunkSize),n=new ue,h=new Set;n.push(new Et(s,r));const o=[1,0,-1,0],a=[0,1,0,-1];let l=0;for(;!n.empty();){100<performance.now()-e&&(e=performance.now(),yield null),l++%10==0&&(yield null);const i=n.front().x,s=n.front().y;if(n.pop(),this.is2DFrustumCulled(t,i,s))continue;const r=`${i}_${s}`;if(h.has(r))continue;h.add(r);for(let t=0;t<4;t++){const e=i+o[t],r=s+a[t];n.push(new Et(e,r))}if(this._activeChunks.has(r))continue;const c=this.getChunkObject();c.elementWidth=this._chunkSize,c.elementHeight=this._chunkSize,this._activeChunks.set(r,c),c.gameObject.transform.position.set(i*this._chunkSize,s*this._chunkSize,0);const u=c.transform.position,d=.5*this._chunkSize;this.xSamplingDrawGraph(c.element.getContext("2d"),this._equation,u.x-d,u.x+d,u.x,u.y,this._viewScale/this._chunkSize)}}clearChunks(){for(const t of this._activeChunks.values())this.releaseChunkObject(t);this._activeChunks.clear()}xSamplingDrawGraph(t,e,i,s,r,n,h){t.clearRect(0,0,this._chunkResolution,this._chunkResolution),t.beginPath();const o=(s-i)/this._sampleCount;for(let h=i-o;h<=s+o;h+=o){const i=e(h)-n,s=(h-r)*this._chunkResolution/this._chunkSize+.5*this._chunkResolution,o=-i*this._chunkResolution/this._chunkSize+.5*this._chunkResolution;t.lineTo(s,o)}t.strokeStyle="#000000",t.lineWidth=h,t.stroke(),t.closePath()}getProgram(t){if(!this._program){const e=t.createProgram(),i=t.createShader(t.VERTEX_SHADER);t.shaderSource(i,"\n                precision mediump float;\n                attribute vec2 position;\n                varying vec2 uv;\n                void main() {\n                    uv = position;\n                    gl_Position = vec4(position, 0, 1);\n                }\n            "),t.compileShader(i);const s=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(s,"\n                precision mediump float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                void main() {\n                    gl_FragColor = texture2D(texture, uv);\n                }\n            "),t.compileShader(s),t.attachShader(e,i),t.deleteShader(i),t.attachShader(e,s),t.deleteShader(s),t.linkProgram(e);const r=t.getProgramInfoLog(e);r&&console.error(r),this._program=e}return this._program}shaderDrawGraph(t){const e=this.getProgram(t);t.useProgram(e);const i=t.getAttribLocation(e,"position"),s=t.getAttribLocation(e,"uv"),r=t.getUniformLocation(e,"texture"),n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),t.STATIC_DRAW),t.enableVertexAttribArray(i),t.vertexAttribPointer(i,2,t.FLOAT,!1,0,0);const h=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,h),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),t.STATIC_DRAW),t.enableVertexAttribArray(s),t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0);const o=t.createTexture();t.bindTexture(t.TEXTURE_2D,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);const a=new Uint8Array(this._chunkResolution*this._chunkResolution*4);for(let t=0;t<this._chunkResolution*this._chunkResolution;t++)a[4*t+0]=255,a[4*t+1]=255,a[4*t+2]=255,a[4*t+3]=255;t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this._chunkResolution,this._chunkResolution,0,t.RGBA,t.UNSIGNED_BYTE,a),t.uniform1i(r,0),t.drawArrays(t.TRIANGLES,0,6)}update(){const t=this.engine.cameraContainer.camera;if(!t)return;const e=t.viewSize,i=t.transform.position,s=this._lastCameraPosition;if(i.x===s.x&&i.y===s.y&&e===this._lastCameraViewSize)return;s.set(i.x,i.y),this._lastCameraViewSize=e;const r=de.computeLod(e);r!==this._lastChunkStep&&(this.clearChunks(),this._lastChunkStep=r,this._chunkSize=this._lastChunkStep*this._cameraRelativeChunkSize),this.startCoroutine(this.renderChunk(t))}is2DFrustumCulled(t,e,i){const s=this._chunkSize,r=this._tempVector3.set(e*s,i*s,0),n=t.transform.inverseTransformPoint(r),h=t.viewSize,o=this.engine.screen.width/this.engine.screen.height,a=-h*o,l=h*o,c=h,u=-h,d=.5*s,m=-d+n.x,p=d+n.x,f=d+n.y,y=-d+n.y;let g,v,x,_;return m<=a&&l<=p?(g=!0,v=!0):(g=a<=m&&m<=l,v=a<=p&&p<=l),y<=u&&c<=f?(x=!0,_=!0):(x=u<=f&&f<=c,_=u<=y&&y<=c),!((g||v)&&(x||_))}onDestroy(){this.clearChunks();const t=this._chunkObjectPool;for(let e=t.length-1;e>=0;e--)t[e].gameObject.destroy();this._chunkObjectPool.length=0}}class pe extends Qt{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.requiredComponents=[te,ee],this._camera=null,this._cameraController=null,this._htmlRenderer=null,this._htmlRendererObject=null,this.onScreenResize=(t,e)=>{if(this._htmlRenderer){const i=this._camera.viewSize,s=t/e;this._htmlRenderer.elementWidth=2*i*s,this._htmlRenderer.elementHeight=2*i,this._gridCellScalar=de.computeLod(i),this._htmlRenderer.element.style.backgroundSize=this._gridCellScalar/this._viewScale+"px "+this._gridCellScalar/this._viewScale+"px"}},this.onZoom=()=>{if(this._htmlRenderer){const t=this.engine.screen;this.onScreenResize(t.width,t.height)}},this._gridCellScalar=2,this._viewScale=.01,this._lastPosition=new j(NaN,NaN,NaN)}awake(){this.engine.screen.onResize.addListener(this.onScreenResize),this._camera=this.gameObject.getComponent(te),this._cameraController=this.gameObject.getComponent(ee),this._cameraController.onZoom.addListener(this.onZoom),this.createRenderer();const t=this.engine.screen;this.onScreenResize(t.width,t.height)}get viewScale(){return this._viewScale}set viewScale(t){this._viewScale=t,this._htmlRenderer&&(this._htmlRenderer.element.style.backgroundSize=this._gridCellScalar/this._viewScale+"px "+this._gridCellScalar/this._viewScale+"px",this._htmlRenderer.viewScale=this._viewScale)}createRenderer(){if(this._htmlRenderer)return;const t=new Bt;this._htmlRendererObject=this.gameObject.addChildFromBuilder(this.engine.instantiater.buildGameObject("grid-renderer",new j(0,0,-1)).active(!1).withComponent(oe,(t=>{const e=document.createElement("div");e.style.backgroundImage="                        repeating-linear-gradient(#ddd 0 1px, transparent 1px 100%),                        repeating-linear-gradient(#eee 0 1px, transparent 1px 50%),                        repeating-linear-gradient(90deg, #ddd 0 1px, transparent 1px 100%),                         repeating-linear-gradient(90deg, #eee 0 1px, transparent 1px 50%)",e.style.backgroundSize=this._gridCellScalar/this._viewScale+"px "+this._gridCellScalar/this._viewScale+"px",t.pointerEvents=!1,t.element=e,t.viewScale=this._viewScale})).getComponent(oe,t)),this._htmlRenderer=t.ref,this._htmlRenderer.enabled=this.enabled}onEnable(){this._htmlRendererObject.exists&&(this._htmlRendererObject.activeSelf=!0)}onDisable(){this._htmlRendererObject.exists&&(this._htmlRendererObject.activeSelf=!1)}update(){const t=this.transform.position,e=this._htmlRenderer,i=e.elementWidth,s=e.elementHeight,r=i/this._viewScale*.5,n=s/this._viewScale*.5;t.equals(this._lastPosition)||(this._htmlRenderer.element.style.backgroundPosition=-t.x/this._viewScale+r+"px "+(t.y/this._viewScale+n)+"px")}onDestroy(){var t;this.engine.screen.onResize.removeListener(this.onScreenResize),this._cameraController.onZoom.removeListener(this.onZoom),this._camera=null,this._cameraController=null,this._htmlRenderer=null,null===(t=this._htmlRendererObject)||void 0===t||t.destroy(),this._htmlRendererObject=null}}class fe extends he{constructor(){super(...arguments),this.Fa=$t.fromHex("#00FF00"),this.An=1,this.Wa=new Et(-2,-2),this.ja=new Et(2,2)}renderInitialize(){this.htmlElement=document.createElement("div"),this.htmlElement.style.backgroundColor=this.Fa.toHexWithAlpha();const t=this.initializeBaseComponents(!1),e=Math.atan2(this.ja.y-this.Wa.y,this.ja.x-this.Wa.x);t.rotation.z=e+Math.PI/2,yt.updateRawObject3DWorldMatrixRecursively(t),this.transform.enqueueRenderAttachedObject3D(t)}updateCenterOffset(t){if(!this.css3DObject)return;const e=2*Math.max(Math.abs(this.Wa.x),Math.abs(this.ja.x)),i=2*Math.max(Math.abs(this.Wa.y),Math.abs(this.ja.y)),s=(this.Wa.x+this.ja.x)/2,r=(this.Wa.y+this.ja.y)/2;this.css3DObject.position.set(e*this.centerOffset.x+s,i*this.centerOffset.y+r,0),t&&(yt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}updateViewScale(t){if(!this.css3DObject)return;const e=this.viewScale;this.css3DObject.element.style.width=this.An/e+"px",this.css3DObject.element.style.height=this.Wa.distanceTo(this.ja)/e+"px",this.css3DObject.scale.set(e,e,e),t&&(yt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}get lineColor(){return this.Fa}set lineColor(t){this.Fa.copy(t),this.htmlElement&&(this.htmlElement.style.backgroundColor=t.toHexWithAlpha())}get lineWidth(){return this.An}set lineWidth(t){this.An=t,this.htmlElement&&(this.htmlElement.style.width=t/this.viewScale+"px")}get point1(){return this.Wa}set point1(t){if(this.Wa.copy(t),this.css3DObject){this.css3DObject.element.style.height=this.Wa.distanceTo(this.ja)/this.viewScale+"px";const t=Math.atan2(this.ja.y-this.Wa.y,this.ja.x-this.Wa.x);this.css3DObject.rotation.z=t+Math.PI/2,this.updateCenterOffset(!0)}}get point2(){return this.ja}set point2(t){if(this.ja.copy(t),this.css3DObject){this.css3DObject.element.style.height=this.Wa.distanceTo(this.ja)/this.viewScale+"px";const t=Math.atan2(this.ja.y-this.Wa.y,this.ja.x-this.Wa.x);this.css3DObject.rotation.z=t+Math.PI/2,this.updateCenterOffset(!0)}}setPoints(t,e){if(this.Wa.copy(t),this.ja.copy(e),this.css3DObject){this.css3DObject.element.style.height=this.Wa.distanceTo(this.ja)/this.viewScale+"px";const t=Math.atan2(this.ja.y-this.Wa.y,this.ja.x-this.Wa.x);this.css3DObject.rotation.z=-t,this.updateCenterOffset(!0)}}}class ye extends Qt{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.requiredComponents=[te,ee],this._camera=null,this._cameraController=null,this._lineWidth=.01,this._axisObject=null,this._xAxisObject=null,this._yAxisObject=null,this._xAxis=null,this._yAxis=null,this._tempVector2=new Et,this.onScreenResize=(t,e)=>{const i=this._camera.viewSize,s=t/e;this._xAxis.point1=this._tempVector2.set(-i*s,0),this._xAxis.point2=this._tempVector2.set(i*s,0),this._yAxis.point1=this._tempVector2.set(0,-i),this._yAxis.point2=this._tempVector2.set(0,i)},this.onZoom=()=>{const t=this.engine.screen;this.onScreenResize(t.width,t.height)},this._lastCameraPosition=new Et(NaN,NaN)}get lineWidth(){return this._lineWidth}set lineWidth(t){this._lineWidth=t,this._xAxis&&(this._xAxis.lineWidth=t),this._yAxis&&(this._yAxis.lineWidth=t)}awake(){this._camera=this.gameObject.getComponent(te),this._cameraController=this.gameObject.getComponent(ee),this._cameraController.onZoom.addListener(this.onZoom),this.engine.screen.onResize.addListener(this.onScreenResize);const t=new Bt,e=new Bt;this._axisObject=this.engine.scene.addChildFromBuilder(this.engine.instantiater.buildGameObject("axis-renderer-axis").withChild(this.engine.instantiater.buildGameObject("axis-renderer-x-axis").withComponent(fe,(t=>{this._xAxis=t,t.lineWidth=this._lineWidth,t.lineColor=new $t(.5,.5,.5)})).getGameObject(t)).withChild(this.engine.instantiater.buildGameObject("axis-renderer-y-axis").withComponent(fe,(t=>{this._yAxis=t,t.lineWidth=this._lineWidth,t.lineColor=new $t(.5,.5,.5)})).getGameObject(e))),this._xAxisObject=t.ref,this._yAxisObject=e.ref,this.onZoom()}update(){const t=this._camera.transform.position,e=t.x,i=t.y,s=this._lastCameraPosition;s.x===e&&s.y===i||(s.x=e,s.y=i,this._xAxisObject.transform.position.x=e,this._yAxisObject.transform.position.y=i)}onDestroy(){var t;this._cameraController.onZoom.removeListener(this.onZoom),this.engine.screen.onResize.removeListener(this.onScreenResize),null===(t=this._axisObject)||void 0===t||t.destroy(),this._axisObject=null,this._xAxisObject=null,this._yAxisObject=null,this._xAxis=null,this._yAxis=null}}var ge,ve;!function(t){t.Left="left",t.Center="center",t.Right="right"}(ge||(ge={})),function(t){t.Normal="normal",t.Bold="bold"}(ve||(ve={}));class xe extends he{constructor(){super(...arguments),this.if=2,this.sf=1,this.iu=!1,this.hf=8,this.ef=ve.Normal,this.rf="Arial",this.nf=ge.Left,this.ff=new $t(1,1,1,1),this.lf=null,this.ma=null}renderInitialize(){var t;null===(t=this.ma)||void 0===t||t.call(this),this.htmlElement||(this.text=xe._defaultText)}updateCenterOffset(t){if(!this.css3DObject)return;let e,i;if(this.iu)if(this.css3DObject.element.parentElement){const t=this.css3DObject.element.style.display;this.css3DObject.element.style.display="",e=this.css3DObject.element.offsetWidth*this.viewScale,i=this.css3DObject.element.offsetHeight*this.viewScale,this.css3DObject.element.style.display=t}else{const t=this.css3DObject.element.style.display;this.css3DObject.element.style.display="";const s=this.css3DObject.element.style.transform;this.css3DObject.element.style.transform="translateX(1000000px)",document.body.appendChild(this.css3DObject.element),e=this.css3DObject.element.offsetWidth*this.viewScale,i=this.css3DObject.element.offsetHeight*this.viewScale,this.css3DObject.element.style.display=t,this.css3DObject.element.style.transform=s,document.body.removeChild(this.css3DObject.element)}else e=this.if,i=this.sf;this.css3DObject.position.set(e*this.centerOffset.x,i*this.centerOffset.y,0),t&&(yt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}updateViewScale(t){if(!this.css3DObject)return;const e=this.viewScale;this.iu?(this.css3DObject.scale.set(e,e,e),this.updateCenterOffset(!1)):(this.css3DObject.element.style.width=this.if/this.viewScale+"px",this.css3DObject.element.style.height=this.sf/this.viewScale+"px",this.css3DObject.scale.set(e,e,e)),t&&(yt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}get text(){return this.lf}set text(t){this.lf=t,this.readyToDraw?this.uf(t):this.ma=()=>this.uf(t)}uf(t){this.htmlElement||(this.htmlElement=document.createElement("div")),this.htmlElement.textContent=null!=t?t:"",this.iu?(this.htmlElement.style.width="auto",this.htmlElement.style.height="auto"):(this.htmlElement.style.width=this.if+"px",this.htmlElement.style.height=this.sf+"px"),this.htmlElement.style.fontSize=this.hf+"px",this.htmlElement.style.fontWeight=this.ef,this.htmlElement.style.fontFamily=this.rf,this.htmlElement.style.textAlign=this.nf,this.htmlElement.style.color=this.ff.toHex(),this.htmlElement.style.opacity=this.ff.a.toString();const e=this.initializeBaseComponents(!1);yt.updateRawObject3DWorldMatrixRecursively(e),this.transform.enqueueRenderAttachedObject3D(e)}get textWidth(){if(this.iu){if(this.htmlElement){const t=this.htmlElement.style.display;this.htmlElement.style.display="";const e=this.htmlElement.offsetWidth;return this.htmlElement.style.display=t,e}return 0}return this.if}set textWidth(t){this.iu||(this.if=t,this.htmlElement&&(this.htmlElement.style.width=t/this.viewScale+"px"),this.updateCenterOffset(!0))}get textHeight(){if(this.iu){if(this.htmlElement){const t=this.htmlElement.style.display;this.htmlElement.style.display="";const e=this.htmlElement.offsetHeight;return this.htmlElement.style.display=t,e}return 0}return this.sf}set textHeight(t){this.iu||(this.sf=t,this.htmlElement&&(this.htmlElement.style.height=t/this.viewScale+"px"),this.updateCenterOffset(!0))}get autoSize(){return this.iu}set autoSize(t){this.iu=t,this.htmlElement&&(t?(this.htmlElement.style.width="auto",this.htmlElement.style.height="auto"):(this.htmlElement.style.width=this.if/this.viewScale+"px",this.htmlElement.style.height=this.sf/this.viewScale+"px"))}get fontSize(){return this.hf}set fontSize(t){this.hf=t,this.htmlElement&&(this.htmlElement.style.fontSize=t+"px")}get fontWeight(){return this.ef}set fontWeight(t){this.ef=t,this.htmlElement&&(this.htmlElement.style.fontWeight=t)}get fontFamily(){return this.rf}set fontFamily(t){this.rf=t,this.htmlElement&&(this.htmlElement.style.fontFamily=t)}get textAlign(){return this.nf}set textAlign(t){this.nf=t,this.htmlElement&&(this.htmlElement.style.textAlign=t)}get textColor(){return this.ff}set textColor(t){this.ff.copy(t),this.htmlElement&&(this.htmlElement.style.color=t.toHex(),this.htmlElement.style.opacity=t.a.toString())}}xe._defaultText="Text";class _e extends Qt{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.requiredComponents=[te,ee],this._camera=null,this._cameraController=null,this.onScreenResize=()=>{this.renderGridUnit(this._camera)},this.onZoom=()=>{this.renderGridUnit(this._camera)},this._textObjectPool=[],this._activeTextX=new Map,this._activeTextY=new Map,this._lastPosition=new Et(NaN,NaN)}awake(){this._camera=this.gameObject.getComponent(te),this._cameraController=this.gameObject.getComponent(ee),this.engine.screen.onResize.addListener(this.onScreenResize),this._cameraController.onZoom.addListener(this.onZoom)}onDestroy(){this.engine.screen.onResize.removeListener(this.onScreenResize),this._cameraController.onZoom.removeListener(this.onZoom),this._camera=null,this._cameraController=null}getTextObject(){let t=this._textObjectPool.pop();if(!t){const e=new Bt;this.gameObject.addChildFromBuilder(this.engine.instantiater.buildGameObject("grid-unit-text").active(!1).withComponent(xe,(t=>{t.textColor=new $t(0,0,0),t.autoSize=!0,t.centerOffset=new Et(.7,.7)})).getComponent(xe,e)),t=e.ref}return t.gameObject.activeSelf=!0,t}releaseTextObject(t){t.gameObject.activeSelf=!1,this._textObjectPool.push(t)}renderGridUnit(t){const e=t.viewSize,i=this.engine.screen,s=i.width/i.height,r=de.computeLod(e);let n=2*Math.floor(e/r)+1;n%2==0&&(n-=1);let h=2*Math.floor(e*s/r)+1;h%2==0&&(h-=1);for(const t of this._activeTextX.values())this.releaseTextObject(t);this._activeTextX.clear();for(const t of this._activeTextY.values())this.releaseTextObject(t);this._activeTextY.clear();const o=t.transform.position;let a=Math.abs((o.x-e*s)%r);o.x-e*s>0&&(a=r-a);const l=e*s*-1+o.x+a;let c=Math.abs((o.y-e)%r);o.y-e>0&&(c=r-c);const u=-1*e+o.y+c;let d,m;d=e<o.y?-e:.07*e-e>o.y?e-.07*e:-o.y;for(let t=0;t<h;++t){const i=a+t*r-e*s,n=this.getTextObject();this._activeTextX.set(i,n),n.text=`${Number((l+t*r).toFixed(3))}`;const h=n.transform.localPosition;h.x=i,h.y=d}const p=e*s;m=p<o.x?-p:.12*e-p>o.x?p-.12*e:-o.x;for(let t=0;t<n;++t){const i=c+t*r-e,s=this.getTextObject();this._activeTextY.set(i,s),s.text=`${Number((u+t*r).toFixed(3))}`;const n=s.transform.localPosition;n.x=m,n.y=i}for(const t of this._activeTextX.values())t.viewScale=.005*e;for(const t of this._activeTextY.values())t.viewScale=.005*e}update(){const t=this._camera.transform.position,e=this._lastPosition;e.x===t.x&&e.y===t.y||(e.x=t.x,e.y=t.y,this.renderGridUnit(this._camera))}}var we;class Ce{static init(){return t=this,e=void 0,s=function*(){Ce._epp=yield a.e(767).then(a.bind(a,767))},new((i=void 0)||(i=Promise))((function(r,n){function h(t){try{a(s.next(t))}catch(t){n(t)}}function o(t){try{a(s.throw(t))}catch(t){n(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(h,o)}a((s=s.apply(t,e||[])).next())}));var t,e,i,s}static disposeAst(t){if(!this._epp)throw new Error("ParserBind is not initialized");this._epp.dispose_ast(t)}static parseBoolExpr(t){if(!this._epp)throw new Error("ParserBind is not initialized");const e=this._epp.parse_bool_expr(t),i=this.parseResult(e,["x","y"]);return e.free(),i}static emitBoolExpr(t){if(!this._epp)throw new Error("ParserBind is not initialized");return this._epp.emit_bool_expr(t,1e-5)}static parseNumberExpr(t){if(!this._epp)throw new Error("ParserBind is not initialized");const e=this._epp.parse_number_expr(t),i=this.parseResult(e,["x"]);return e.free(),i}static emitNumberExpr(t){if(!this._epp)throw new Error("ParserBind is not initialized");return this._epp.emit_number_expr(t)}static parseResult(t,e){const i=-1===t.ast_id?null:new be(t.ast_id,e),s=JSON.parse(t.diagnostics).map((t=>["Error"===t.level?we.Error:we.Warning,t.message]));return new Me(i,s)}static differentiateExpr(t){if(!this._epp)throw new Error("ParserBind is not initialized");return this._epp.differentiate_expr(t)}static astToString(t){if(!this._epp)throw new Error("ParserBind is not initialized");return this._epp.ast_to_string(t)}static foldExpr(t){if(!this._epp)throw new Error("ParserBind is not initialized");return this._epp.fold_expr(t)}}Ce._epp=null;class be{constructor(t,e){this._astId=t,this._params=e}get params(){return this._params}dispose(){0!==this._astId&&(Ce.disposeAst(this._astId),this._astId=0)}emit(){if(0===this._astId)throw new Error("Ast is disposed");if(0===this._params.length)throw new Error("Ast has no parameters");if(1===this._params.length)return new Function(...this.params,"return "+Ce.emitBoolExpr(this._astId));if(2===this._params.length)return new Function(...this.params,"return "+Ce.emitNumberExpr(this._astId));throw new Error("Ast has too many parameters")}differentiate(){if(0===this._astId)throw new Error("Ast is disposed");const t=Ce.differentiateExpr(this._astId),e=-1===t.ast_id?null:new be(t.ast_id,this._params),i=new Ee(e,t.error);return t.free(),i}toString(){if(0===this._astId)throw new Error("Ast is disposed");return Ce.astToString(this._astId)}fold(){if(0===this._astId)throw new Error("Ast is disposed");const t=Ce.foldExpr(this._astId);return new be(t,this._params)}}class Me{constructor(t,e){this.ast=t,this.error=e}dispose(){this.ast&&this.ast.dispose()}}class Ee{constructor(t,e){this.ast=t,this.error=e}dispose(){this.ast&&this.ast.dispose()}}!function(t){t[t.Warning=0]="Warning",t[t.Error=1]="Error"}(we||(we={}));class Se extends Qt{constructor(){super(...arguments),this._equationInputField=null,this._errorMessageDiv=null,this._debounceTimeout=null,this._graphRenderer=null,this._onEquationEmited=new g,this._equation=null,this._derivatedFunction=null,this.onEquationInputFieldChange=t=>{const e=t.target;this._debounceTimeout&&clearTimeout(this._debounceTimeout),this._debounceTimeout=window.setTimeout((()=>{this._debounceTimeout=null,this.onEquationInputFieldChangeDebounced(e.value)}),500)}}onEquationInputFieldChangeDebounced(t){var e;if(!t.replace(/\s/g,"").startsWith("y=")){const t=this.errorMessageDiv;return void(t&&(t.innerHTML="",t.appendChild(new Text("Error: The equation must start with 'y='")),t.appendChild(document.createElement("br"))))}const i=Ce.parseNumberExpr(t.split("=")[1]),s=i.ast;if(!s){const t=this.errorMessageDiv;if(t){t.innerHTML="",t.style.color="red";const e=i.error;for(let i=0;i<e.length;++i){const[s,r]=e[i];t.appendChild(new Text(`${s===we.Error?"Error":"Warning"}: ${r}`)),t.appendChild(document.createElement("br"))}}return}const r=s.differentiate(),n=null===(e=r.ast)||void 0===e?void 0:e.fold(),h=this.errorMessageDiv;if(h)if(h.innerHTML="",r.ast){h.style.color="black",h.appendChild(new Text(`transformed: ${r.ast.toString()}`)),h.appendChild(document.createElement("br")),h.appendChild(new Text(`folded: ${n.toString()}`));const t=this._equation=s.emit(),e=this._derivatedFunction=n.emit();this._onEquationEmited.invoke(t,e)}else h.style.color="red",h.appendChild(new Text(`Transform Error: ${r.error}`));this._graphRenderer&&(this._graphRenderer.equation=s.emit()),null==n||n.dispose(),null==r||r.dispose(),i.dispose()}get equationInputField(){return this._equationInputField}set equationInputField(t){this._equationInputField&&this._equationInputField.removeEventListener("input",this.onEquationInputFieldChange),this._equationInputField=t,t&&(t.addEventListener("input",this.onEquationInputFieldChange),this.onEquationInputFieldChangeDebounced(t.value))}get errorMessageDiv(){return this._errorMessageDiv}set errorMessageDiv(t){this._errorMessageDiv=t}get graphRenderer(){return this._graphRenderer}set graphRenderer(t){var e,i;this._graphRenderer=t,this.onEquationInputFieldChangeDebounced(null!==(i=null===(e=this._equationInputField)||void 0===e?void 0:e.value)&&void 0!==i?i:"")}get onEquationEmited(){return this._onEquationEmited}get equation(){return this._equation}get derivatedFunction(){return this._derivatedFunction}onDestroy(){this._equationInputField&&this._equationInputField.removeEventListener("input",this.onEquationInputFieldChange)}}class Oe{constructor(t,e){this._position=new Et(t.x,t.y),this._button=e}get position(){return this._position}get button(){return this._button}}class ze extends Qt{constructor(){super(...arguments),this.requiredComponents=[te],this.disallowMultipleComponent=!0,this._onPointerDownEvent=new g,this._onPointerUpEvent=new g,this._onPointerEnterEvent=new g,this._onPointerLeaveEvent=new g,this._onPointerMoveEvent=new g,this._onTouchStartFunc=null,this._touchMoveOccured=!1,this._camera=null,this._htmlRenderer=null,this._cameraController=null,this.updateSize=()=>{const t=this._htmlRenderer,e=this._camera.viewSize,i=this.engine.screen,s=i.width/i.height;t.elementWidth=2*e*s,t.elementHeight=2*e},this.onScreenResize=(t,e)=>{if(this._htmlRenderer){const i=this._camera.viewSize,s=t/e;this._htmlRenderer.elementWidth=2*i*s,this._htmlRenderer.elementHeight=2*i}},this._tempVector2=new Et,this.onMouseDown=t=>{this._onPointerDownEvent.invoke(this.makePointerEvent(t))},this.onMouseUp=t=>{this._onPointerUpEvent.invoke(this.makePointerEvent(t))},this.onMouseEnter=t=>{this._onPointerEnterEvent.invoke(this.makePointerEvent(t))},this.onMouseLeave=t=>{this._onPointerLeaveEvent.invoke(this.makePointerEvent(t))},this.onMouseMove=t=>{this._onPointerMoveEvent.invoke(this.makePointerEvent(t))},this.onTouchStart=t=>{this._onTouchStartFunc=()=>{this.simulateMouseEvent("mouseenter",t.touches[0]),this.simulateMouseEvent("mousedown",t.touches[0])}},this.onTouchEnd=t=>{this._touchMoveOccured&&(this._touchMoveOccured=!1,this.simulateMouseEvent("mouseup",t.changedTouches[0]),this.simulateMouseEvent("mouseleave",t.changedTouches[0]))},this.onTouchMove=t=>{this._onTouchStartFunc&&(this._onTouchStartFunc(),this._onTouchStartFunc=null),this.simulateMouseEvent("mousemove",t.touches[0]),this._touchMoveOccured=!0},this.onTouchCancel=t=>{this._touchMoveOccured&&(this._touchMoveOccured=!1,this.simulateMouseEvent("mouseleave",t.changedTouches[0]))}}awake(){this.engine.screen.onResize.addListener(this.onScreenResize),this._camera=this.gameObject.getComponent(te);const t=this.createRenderer(),e=this._camera.viewSize,i=this.engine.screen,s=i.width/i.height;t.elementWidth=2*e*s,t.elementHeight=2*e,this._cameraController=this.gameObject.getComponent(ee),this._cameraController&&this._cameraController.onZoom.addListener(this.updateSize)}createRenderer(){if(this._htmlRenderer)return this._htmlRenderer;this._htmlRenderer=this.gameObject.addComponent(oe),this._htmlRenderer.enabled=this.enabled;const t=document.createElement("div");return t.addEventListener("mousedown",this.onMouseDown),t.addEventListener("mouseup",this.onMouseUp),t.addEventListener("mouseenter",this.onMouseEnter),t.addEventListener("mouseleave",this.onMouseLeave),t.addEventListener("mousemove",this.onMouseMove),t.addEventListener("touchstart",this.onTouchStart),t.addEventListener("touchend",this.onTouchEnd),t.addEventListener("touchmove",this.onTouchMove),t.addEventListener("touchcancel",this.onTouchCancel),this._htmlRenderer.element=t,this._htmlRenderer.viewScale=ze._viewScale,this._htmlRenderer}onEnable(){this._htmlRenderer.exists&&(this._htmlRenderer.enabled=!0)}onDisable(){this._htmlRenderer.exists&&(this._htmlRenderer.enabled=!1)}onDestroy(){this.engine.screen.onResize.removeListener(this.onScreenResize),this._htmlRenderer&&(this._htmlRenderer.destroy(),this._htmlRenderer=null),this._cameraController&&(this._cameraController.onZoom.removeListener(this.updateSize),this._cameraController=null)}makePointerEvent(t){const e=this._camera.viewSize,i=this.engine.screen,s=i.width/i.height;return new Oe(this._tempVector2.set(t.offsetX*ze._viewScale-e*s,-t.offsetY*ze._viewScale+e),t.button)}simulateMouseEvent(t,e){const i=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,detail:1,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:null});e.target.dispatchEvent(i)}get onPointerDown(){return this._onPointerDownEvent}get onPointerUp(){return this._onPointerUpEvent}get onPointerEnter(){return this._onPointerEnterEvent}get onPointerLeave(){return this._onPointerLeaveEvent}get onPointerMove(){return this._onPointerMoveEvent}}ze._viewScale=.001;class ke extends Qt{constructor(){super(...arguments),this._iteration=100,this._lastCursorPositionX=NaN,this._viewScale=.1,this._uiController=null,this._pointerInputListener=null,this._resultDiv=null,this.equation=t=>NaN,this.derivatedFunction=t=>NaN,this._tempVector=new j,this._animation=null,this.onEquationEmited=(t,e)=>{this.equation=t,this.derivatedFunction=e},this._lastCursorDownTime=0,this.onCursorDown=t=>{if(0!==t.button)return;const e=Date.now();e-this._lastCursorDownTime<200&&(this.onDoubleClick(t),this._lastCursorDownTime=0),this._lastCursorDownTime=e},this._spawnedObjects=[],this._tempVector2=new Et,this._tempColor=new $t,this._waitForSeconds=new u(.1)}onDoubleClick(t){const e=this.engine.cameraContainer.camera.transform.transformPoint(this._tempVector.set(t.position.x,t.position.y,0));this._animation&&this.stopCoroutine(this._animation),this._lastCursorPositionX=e.x,this._animation=this.startCoroutine(this.solve(e.x))}*solve(t){const e=this._spawnedObjects;for(let t=0;t<e.length;t++)e[t].destroy();e.length=0,yield this._waitForSeconds;for(let i=0;i<this._iteration;i++){const s=this.equation(t),r=this.derivatedFunction(t);if(isNaN(r))break;const n=(r*t-s)/r,h=new Bt;this.engine.scene.addChildFromBuilder(this.engine.instantiater.buildGameObject(`gradient-line-${i}`).withComponent(fe,(e=>{e.point1=this._tempVector2.set(t,s),e.point2=this._tempVector2.set(n,0),e.lineColor=this._tempColor.set(1,.5,.5),e.lineWidth=this._viewScale})).getComponent(fe,h)),e.push(h.ref),yield this._waitForSeconds;const o=this.equation(n);if(!isNaN(o)){const t=new Bt;this.engine.scene.addChildFromBuilder(this.engine.instantiater.buildGameObject(`vertical-line-${i}`).withComponent(fe,(t=>{t.point1=this._tempVector2.set(n,0),t.point2=this._tempVector2.set(n,o),t.lineColor=this._tempColor.set(.5,1,.5),t.lineWidth=this._viewScale})).getComponent(fe,t)),e.push(t.ref);const s=this._resultDiv;s&&(s.innerText=`root: ${Number(n.toFixed(6))}`),yield this._waitForSeconds}t=n}yield null}get uiController(){return this._uiController}set uiController(t){this._uiController&&(this._uiController.onEquationEmited.removeListener(this.onEquationEmited),this.equation=t=>NaN,this.derivatedFunction=t=>NaN),this._uiController=t,this._uiController&&(this._uiController.onEquationEmited.addListener(this.onEquationEmited),this._uiController.equation&&this._uiController.derivatedFunction&&this.onEquationEmited(this._uiController.equation,this._uiController.derivatedFunction))}get pointerInputListener(){return this._pointerInputListener}set pointerInputListener(t){this._pointerInputListener&&this._pointerInputListener.onPointerDown.removeListener(this.onCursorDown),this._pointerInputListener=t,this._pointerInputListener&&this._pointerInputListener.onPointerDown.addListener(this.onCursorDown)}get iteration(){return this._iteration}set iteration(t){this._iteration=t,this._animation&&this.stopCoroutine(this._animation),this._animation=this.startCoroutine(this.solve(this._lastCursorPositionX))}get resultDiv(){return this._resultDiv}set resultDiv(t){this._resultDiv=t}get lineWidth(){return this._viewScale}set lineWidth(t){this._viewScale=t;const e=this._spawnedObjects;for(let i=0;i<e.length;i++)e[i].lineWidth=t}onDestroy(){this._uiController&&this._uiController.onEquationEmited.removeListener(this.onEquationEmited),this._pointerInputListener&&this._pointerInputListener.onPointerDown.removeListener(this.onCursorDown),this._uiController=null,this._pointerInputListener=null}}class Te extends class{constructor(t,e){this.P=t.instantiater,this.L=e||null,this.U=new Lt(t.sceneProcessor),this.S=new Vt(Vt.createDefaultObject())}getGameSettingObject(){return Object.freeze(this.S),this.S.make()}get instantiater(){return this.P}get interopObject(){return this.L}get sceneBuilder(){return this.U}get setting(){return this.S}}{run(){const t=this.instantiater,e=new Bt,i=new Bt,s=new Bt,r=new Bt;return this.sceneBuilder.withChild(t.buildGameObject("ui-controller").withComponent(Se,(t=>{t.equationInputField=document.getElementById("input_equation"),t.errorMessageDiv=document.getElementById("error_message"),t.graphRenderer=i.ref})).getComponent(Se,r)).withChild(t.buildGameObject("graph-renderer").withComponent(me).withComponent(ie,(t=>{t.cameraRelativeScale=2;const i=t.gameObject.getComponent(me);t.onZoom=t=>{i.viewScale=t},t.cameraController=e.ref})).getComponent(me,i)).withChild(t.buildGameObject("solver").withComponent(ke,(t=>{t.uiController=r.ref,t.pointerInputListener=s.ref,t.resultDiv=document.getElementById("result_message")})).withComponent(ie,(t=>{t.cameraRelativeScale=.01;const i=t.gameObject.getComponent(ke);t.onZoom=t=>{i.lineWidth=t},t.cameraController=e.ref}))).withChild(t.buildGameObject("camera",new j(0,0,1)).withComponent(te,(t=>t.viewSize=4)).withComponent(ee).withComponent(pe).withComponent(_e).withComponent(ye).withComponent(ie,(t=>{t.cameraRelativeScale=.003;const i=t.gameObject.getComponent(pe),s=t.gameObject.getComponent(ye);t.onZoom=t=>{i.viewScale=t,s.lineWidth=2*t},t.cameraController=e.ref})).withComponent(ze,(t=>{const e=new j;t.onPointerMove.addListener((i=>{e.set(i.position.x,i.position.y,0),t.transform.transformPoint(e)}))})).getComponent(ee,e).getComponent(ze,s))}}Ce.init().then((()=>{globalThis.ParserBind=Ce;const t=new It(document.getElementById("game_view"),!0);t.run(Te),t.inputHandler.startHandleEvents()}))})();